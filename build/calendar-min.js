/*! BUI - v0.1.0 - 2013-11-18
* https://github.com/dxq613/bui
* Copyright (c) 2013 dxq613; Licensed MIT */
define("bui/calendar",["bui/common","bui/calendar/calendar","bui/calendar/monthpicker","bui/calendar/datepicker"],function(a){var b=a("bui/common"),c=b.namespace("Calendar");return b.mix(c,{Calendar:a("bui/calendar/calendar"),MonthPicker:a("bui/calendar/monthpicker"),DatePicker:a("bui/calendar/datepicker")}),c}),define("bui/calendar/monthpicker",["bui/common","bui/overlay","bui/list","bui/toolbar"],function(a){function b(){return $.map(l,function(a,b){return{text:a,value:b}})}var c=a("bui/common"),d=(c.Component,a("bui/overlay").Overlay),e=a("bui/list").SimpleList,f=a("bui/toolbar"),g=c.prefix,h="x-monthpicker-month",i="x-monthpicker-year",j="x-monthpicker-yearnav",k="x-monthpicker-item",l=["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],m=e.extend({bindUI:function(){var a=this;a.get("el").delegate("a","click",function(a){a.preventDefault()}).delegate("."+h,"dblclick",function(){a.fire("dblclick")})}},{ATTRS:{itemTpl:{view:!0,value:'<li class="'+k+' x-monthpicker-month"><a href="#" hidefocus="on">{text}</a></li>'},itemCls:{value:k},items:{view:!0,value:b()},elCls:{view:!0,value:"x-monthpicker-months"}}},{xclass:"calendar-month-panel"}),n=e.extend({bindUI:function(){var a=this,b=a.get("el");b.delegate("a","click",function(a){a.preventDefault()}),b.delegate("."+i,"dblclick",function(){a.fire("dblclick")}),b.delegate(".x-icon","click",function(b){var c=$(b.currentTarget);c.hasClass(j+"-prev")?a._prevPage():c.hasClass(j+"-next")&&a._nextPage()}),a.on("itemselected",function(b){b.item&&a.setInternal("year",b.item.value)})},_prevPage:function(){var a=this,b=a.get("start"),c=a.get("yearCount");a.set("start",b-c)},_nextPage:function(){var a=this,b=a.get("start"),c=a.get("yearCount");a.set("start",b+c)},_uiSetStart:function(){var a=this;a._setYearsContent()},_uiSetYear:function(a){var b=this,c=b.findItemByField("value",a);c?b.setSelectedByField(a):b.set("start",a)},_setYearsContent:function(){for(var a=this,b=a.get("year"),c=a.get("start"),d=a.get("yearCount"),e=[],f=c;c+d>f;f++){var g=f.toString();e.push({text:g,value:f})}a.set("items",e),a.setSelectedByField(b)}},{ATTRS:{items:{view:!0,value:[]},elCls:{view:!0,value:"x-monthpicker-years"},itemCls:{value:k},year:{},start:{value:(new Date).getFullYear()},yearCount:{value:10},itemTpl:{view:!0,value:'<li class="'+k+" "+i+'"><a href="#" hidefocus="on">{text}</a></li>'},tpl:{view:!0,value:'<div class="'+j+'">'+'<span class="'+j+'-prev x-icon x-icon-normal x-icon-small"><span class="icon icon-caret icon-caret-left"></span></span>'+'<span class="'+j+'-next x-icon x-icon-normal x-icon-small"><span class="icon icon-caret icon-caret-right"></span></span>'+"</div>"+"<ul></ul>"}}},{xclass:"calendar-year-panel"}),o=d.extend({initializer:function(){var a=this,b=a.get("children"),c=new m,d=new n,e=a._createFooter();b.push(c),b.push(d),b.push(e),a.set("yearPanel",d),a.set("monthPanel",c)},bindUI:function(){var a=this;a.get("monthPanel").on("itemselected",function(b){b.item&&a.setInternal("month",b.item.value)}).on("dblclick",function(){a._successCall()}),a.get("yearPanel").on("itemselected",function(b){b.item&&a.setInternal("year",b.item.value)}).on("dblclick",function(){a._successCall()})},_successCall:function(){var a=this,b=a.get("success");b&&b.call(a)},_createFooter:function(){var a=this;return new f.Bar({elCls:g+"clear x-monthpicker-footer",children:[{xclass:"bar-item-button",text:"\u786e\u5b9a",btnCls:"button button-small button-primary",handler:function(){a._successCall()}},{xclass:"bar-item-button",text:"\u53d6\u6d88",btnCls:"button button-small last",handler:function(){var b=a.get("cancel");b&&b.call(a)}}]})},_uiSetYear:function(a){this.get("yearPanel").set("year",a)},_uiSetMonth:function(a){this.get("monthPanel").setSelectedByField(a)}},{ATTRS:{footer:{},align:{value:{}},year:{},success:{value:function(){}},cancel:{value:function(){}},width:{value:180},month:{},yearPanel:{},monthPanel:{}}},{xclass:"monthpicker"});return o}),define("bui/calendar/header",["bui/common"],function(a){var b=a("bui/common"),c=b.prefix,d=b.Component,e="year-text",f="month-text",g="x-datepicker-arrow",h="x-datepicker-prev",i="x-datepicker-next",j=d.Controller.extend({bindUI:function(){var a=this,b=a.get("el");b.delegate("."+g,"click",function(b){b.preventDefault();var c=$(b.currentTarget);c.hasClass(i)?a.nextMonth():c.hasClass(h)&&a.prevMonth()}),b.delegate(".x-datepicker-month","click",function(){a.fire("headerclick")})},setMonth:function(a,b){var c=this,d=c.get("year"),e=c.get("month");(a!==d||b!==e)&&(c.set("year",a),c.set("month",b),c.fire("monthchange",{year:a,month:b}))},nextMonth:function(){var a=this,b=new Date(a.get("year"),a.get("month")+1);a.setMonth(b.getFullYear(),b.getMonth())},prevMonth:function(){var a=this,b=new Date(a.get("year"),a.get("month")-1);a.setMonth(b.getFullYear(),b.getMonth())},_uiSetYear:function(a){var b=this;b.get("el").find("."+e).text(a)},_uiSetMonth:function(a){var b=this;b.get("el").find("."+f).text(a+1)}},{ATTRS:{year:{sync:!1},month:{sync:!1,setter:function(a){this.set("monthText",a+1)}},monthText:{},tpl:{view:!0,value:'<div class="'+g+" "+h+'"><span class="icon icon-white icon-caret  icon-caret-left"></span></div>'+'<div class="x-datepicker-month">'+'<div class="month-text-container">'+'<span><span class="year-text">{year}</span>\u5e74 <span class="month-text">{monthText}</span>\u6708</span>'+'<span class="'+c+"caret "+c+'caret-down"></span>'+"</div>"+"</div>"+'<div class="'+g+" "+i+'"><span class="icon icon-white icon-caret  icon-caret-right"></span></div>'},elCls:{view:!0,value:"x-datepicker-header"},events:{value:{monthchange:!0}}}},{xclass:"calendar-header"});return j}),define("bui/calendar/panel",["bui/common"],function(a){var b=a("bui/common"),c=b.Component,d=b.Date,e="x-datepicker-date",f="x-datepicker-today",g="x-datepicker-disabled",h="isoDate",i="x-datepicker-selected",j=6,k={deactive:"prevday",active:"active",disabled:"disabled"},l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],m=c.View.extend({renderUI:function(){this.updatePanel()},updatePanel:function(){var a=this,b=a.get("el"),c=b.find("tbody"),d=a._getPanelInnerTpl();c.empty(),$(d).appendTo(c)},_getPanelInnerTpl:function(){for(var a=this,b=a._getFirstDate(),c=[],e=0;j>e;e++){var f=d.addWeek(e,b);c.push(a._getWeekTpl(f))}return c.join("")},_getWeekTpl:function(a){for(var c=this,e=c.get("weekTpl"),f=[],g=0;g<l.length;g++){var h=d.addDay(g,a);f.push(c._getDayTpl(h))}return b.substitute(e,{daysTpl:f.join("")})},_getDayTpl:function(a){var c=this,e=c.get("dayTpl"),g=a.getDay(),i=c._isToday(a)?f:"",j=l[g],m=a.getDate(),n=c._isInRange(a)?c._isCurrentMonth(a)?k.active:k.deactive:k.disabled;return b.substitute(e,{dayOfWeek:j,dateType:n,dateNumber:m,todayCls:i,date:d.format(a,h)})},_getFirstDate:function(a,b){var c=this,e=c._getMonthFirstDate(a,b),f=e.getDay();return d.addDay(-1*f,e)},_getMonthFirstDate:function(a,b){var c=this,a=a||c.get("year"),b=b||c.get("month");return new Date(a,b)},_isCurrentMonth:function(a){return a.getMonth()===this.get("month")},_isToday:function(a){var b=new Date;return b.getFullYear()===a.getFullYear()&&b.getMonth()===a.getMonth()&&b.getDate()===a.getDate()},_isInRange:function(a){var b=this,c=b.get("maxDate"),d=b.get("minDate");return d&&d>a?!1:c&&a>c?!1:!0},_clearSelectedDate:function(){var a=this;a.get("el").find("."+i).removeClass(i)},_findDateElement:function(a){var b=this,c=d.format(a,h),f=b.get("el").find("."+e),g=null;return c&&f.each(function(a,b){return $(b).attr("title")===c?(g=$(b),!1):void 0}),g},_setSelectedDate:function(a){var b=this,c=b._findDateElement(a);b._clearSelectedDate(),c&&c.addClass(i)}},{ATTRS:{}}),n=c.Controller.extend({initializer:function(){var a=this,b=new Date;a.get("year")||a.set("year",b.getFullYear()),a.get("month")||a.set("month",b.getMonth())},bindUI:function(){var a=this,b=a.get("el");b.delegate("."+e,"click",function(a){a.preventDefault()}),b.delegate("."+g,"mouseup",function(a){a.stopPropagation()})},performActionInternal:function(a){var b=this,c=$(a.target).closest("."+e);if(c){var f=c.attr("title");f&&(f=d.parse(f),b.get("view")._isInRange(f)&&b.set("selected",f))}},setMonth:function(a,b){var c=this,d=c.get("year"),e=c.get("month");(a!==d||b!==e)&&(c.set("year",a),c.set("month",b),c.get("view").updatePanel())},_uiSetSelected:function(a,b){var c=this;b&&b.prevVal&&d.isDateEquals(a,b.prevVal)||(c.setMonth(a.getFullYear(),a.getMonth()),c.get("view")._setSelectedDate(a),c.fire("selectedchange",{date:a}))},_uiSetMaxDate:function(a){a&&this.get("view").updatePanel()},_uiSetMinDate:function(a){a&&this.get("view").updatePanel()}},{ATTRS:{year:{view:!0},month:{view:!0},selected:{},focusable:{value:!0},dayTpl:{view:!0,value:'<td class="x-datepicker-date x-datepicker-{dateType} {todayCls} day-{dayOfWeek}" title="{date}"><a href="#" hidefocus="on" tabindex="1"><em><span>{dateNumber}</span></em></a></td>'},events:{value:{click:!1,selectedchange:!1}},maxDate:{view:!0,setter:function(a){return a?b.isString(a)?d.parse(a):a:void 0}},minDate:{view:!0,setter:function(a){return a?b.isString(a)?d.parse(a):a:void 0}},weekTpl:{view:!0,value:"<tr>{daysTpl}</tr>"},tpl:{view:!0,value:'<table class="x-datepicker-inner" cellspacing="0"><thead><tr><th  title="Sunday"><span>\u65e5</span></th><th  title="Monday"><span>\u4e00</span></th><th  title="Tuesday"><span>\u4e8c</span></th><th  title="Wednesday"><span>\u4e09</span></th><th  title="Thursday"><span>\u56db</span></th><th  title="Friday"><span>\u4e94</span></th><th  title="Saturday"><span>\u516d</span></th></tr></thead><tbody class="x-datepicker-body"></tbody></table>'},xview:{value:m}}},{xclass:"calendar-panel",priority:0});return n}),define("bui/calendar/calendar",["bui/picker","bui/calendar/monthpicker","bui/calendar/header","bui/calendar/panel","bui/toolbar"],function(a){function b(){var a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate())}function c(a){return 10>a?"0"+a:a.toString()}function d(a){for(var b=[],d=0;a>d;d++)b.push({text:c(d),value:c(d)});return b}function e(a,b,d){var e=a.get("el").find("."+b);f.isNumber(d)&&(d=c(d)),e.val(d)}var f=a("bui/common"),g=f.prefix,h="x-datepicker-time",i="x-datepicker-hour",j="x-datepicker-minute",k="x-datepicker-second",l="x-timepicker",m=a("bui/picker").ListPicker,n=a("bui/calendar/monthpicker"),o=a("bui/calendar/header"),p=a("bui/calendar/panel"),q=a("bui/toolbar"),r=f.Component,s=f.Date,t=r.Controller.extend({initializer:function(){var a=this,b=a.get("children"),c=new o,d=new p,e=a.get("footer")||a._createFooter();b.push(c),b.push(d),b.push(e),a.set("header",c),a.set("panel",d),a.set("footer",e)},renderUI:function(){var a=this,b=a.get("children");if(a.get("showTime")){var c=a.get("timepicker")||a._initTimePicker();b.push(c),a.set("timepicker",c)}},bindUI:function(){var a=this,b=a.get("header"),c=a.get("panel");c.on("selectedchange",function(b){var c=b.date;s.isDateEquals(c,a.get("selectedDate"))||a.set("selectedDate",c)}),a.get("showTime")?a._initTimePickerEvent():c.on("click",function(){a.fire("accept")}),b.on("monthchange",function(b){a._setYearMonth(b.year,b.month)}),b.on("headerclick",function(){var c=a.get("monthpicker")||a._createMonthPicker();c.set("year",b.get("year")),c.set("month",b.get("month")),c.show()})},_initTimePicker:function(){var a=this,b=a.get("lockTime"),c={hour:i,minute:j,second:k};if(b)for(var d in b){var e=c[d.toLowerCase()];a.set(d,b[d]),a.get("el").find("."+e).attr("disabled","")}var f=new m({elCls:l,children:[{itemTpl:'<li><a href="#">{text}</a></li>'}],autoAlign:!1,align:{node:a.get("el"),points:["bl","bl"],offset:[0,-30]},trigger:a.get("el").find("."+h)});return f.render(),a._initTimePickerEvent(f),f},_initTimePickerEvent:function(a){var b=this,a=b.get("timepicker");a&&(a.get("el").delegate("a","click",function(a){a.preventDefault()}),a.on("triggerchange",function(b){var c=b.curTrigger;c.hasClass(i)?a.get("list").set("items",d(24)):a.get("list").set("items",d(60))}),a.on("selectedchange",function(a){var c=a.curTrigger,d=a.value;c.hasClass(i)?b.setInternal("hour",d):c.hasClass(j)?b.setInternal("minute",d):b.setInternal("second",d)}))},_setYearMonth:function(a,b){var c=this,d=c.get("selectedDate"),e=d.getDate();(a!==d.getFullYear()||b!==d.getMonth())&&c.set("selectedDate",new Date(a,b,e))},_createMonthPicker:function(){var a,b=this;return a=new n({render:b.get("el"),effect:{effect:"slide",duration:300},visibleMode:"display",success:function(){var a=this;b._setYearMonth(a.get("year"),a.get("month")),a.hide()},cancel:function(){this.hide()}}),b.set("monthpicker",a),b.get("children").push(a),a},_createFooter:function(){var a=this,c=this.get("showTime"),d=[];return c?(d.push({content:a.get("timeTpl")}),d.push({xclass:"bar-item-button",text:"\u786e\u5b9a",btnCls:"button button-small button-primary",listeners:{click:function(){a.fire("accept")}}})):d.push({xclass:"bar-item-button",text:"\u4eca\u5929",btnCls:"button button-small",id:"todayBtn",listeners:{click:function(){var c=b();a.set("selectedDate",c),a.fire("accept")}}}),new q.Bar({elCls:g+"calendar-footer",children:d})},_updateTodayBtnAble:function(){var a=this;if(!a.get("showTime")){var c=a.get("footer"),d=a.get("panel").get("view"),e=b(),f=c.getItem("todayBtn");d._isInRange(e)?f.enable():f.disable()}},_uiSetSelectedDate:function(a){var b=this,c=a.getFullYear(),d=a.getMonth();b.get("header").setMonth(c,d),b.get("panel").set("selected",a),b.fire("datechange",{date:a})},_uiSetHour:function(a){e(this,i,a)},_uiSetMinute:function(a){e(this,j,a)},_uiSetSecond:function(a){e(this,k,a)},_uiSetMaxDate:function(a){var b=this;b.get("panel").set("maxDate",a),b._updateTodayBtnAble()},_uiSetMinDate:function(a){var b=this;b.get("panel").set("minDate",a),b._updateTodayBtnAble()}},{ATTRS:{header:{},panel:{},maxDate:{},minDate:{},monthPicker:{},timepicker:{},width:{value:180},events:{value:{click:!1,accept:!1,datechange:!1,monthchange:!1}},showTime:{value:!1},lockTime:{},timeTpl:{value:'<input type="text" readonly class="'+h+" "+i+'" />:<input type="text" readonly class="'+h+" "+j+'" />:<input type="text" readonly class="'+h+" "+k+'" />'},selectedDate:{value:b()},hour:{value:(new Date).getHours()},minute:{value:(new Date).getMinutes()},second:{value:0}}},{xclass:"calendar",priority:0});return t}),define("bui/calendar/datepicker",["bui/common","bui/picker","bui/calendar/calendar"],function(a){var b=a("bui/common"),c=a("bui/picker").Picker,d=a("bui/calendar/calendar"),e=b.Date,f=c.extend({initializer:function(){},createControl:function(){var a=this,b=a.get("children"),c=new d({render:a.get("el"),showTime:a.get("showTime"),lockTime:a.get("lockTime"),minDate:a.get("minDate"),maxDate:a.get("maxDate"),autoRender:!0});return a.get("dateMask")||(a.get("showTime")?a.set("dateMask","yyyy-mm-dd HH:MM:ss"):a.set("dateMask","yyyy-mm-dd")),b.push(c),a.set("calendar",c),c},setSelectedValue:function(a){if(this.get("calendar")){var b=this,c=this.get("calendar"),d=e.parse(a,b.get("dateMask"));if(d=d||new Date((new Date).setSeconds(0)),c.set("selectedDate",e.getDate(d)),b.get("showTime")){var f=this.get("lockTime"),g=f&&f.hour?f.hour:d.getHours(),h=f&&f.minute?f.minute:d.getMinutes(),i=f&&f.second?f.second:d.getSeconds();c.set("hour",g),c.set("minute",h),c.set("second",i)}}},getSelectedValue:function(){if(!this.get("calendar"))return null;var a=this,b=a.get("calendar"),c=e.getDate(b.get("selectedDate"));return a.get("showTime")&&(c=e.addHour(b.get("hour"),c),c=e.addMinute(b.get("minute"),c),c=e.addSecond(b.get("second"),c)),c},getSelectedText:function(){return this.get("calendar")?e.format(this.getSelectedValue(),this._getFormatType()):""},_getFormatType:function(){return this.get("dateMask")},_uiSetMaxDate:function(a){if(!this.get("calendar"))return null;var b=this;b.get("calendar").set("maxDate",a)},_uiSetMinDate:function(a){if(!this.get("calendar"))return null;var b=this;b.get("calendar").set("minDate",a)}},{ATTRS:{showTime:{value:!1},lockTime:{},maxDate:{},minDate:{},dateMask:{},changeEvent:{value:"accept"},hideEvent:{value:"accept"},calendar:{}}},{xclass:"datepicker",priority:0});return f});