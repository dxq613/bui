/*! BUI - v0.1.0 - 2013-11-18
* https://github.com/dxq613/bui
* Copyright (c) 2013 dxq613; Licensed MIT */
!function(){var a="bui/form/";define("bui/form",["bui/common",a+"fieldcontainer",a+"form",a+"row",a+"fieldgroup",a+"horizontal",a+"rules",a+"field",a+"fieldgroup"],function(b){var c=b("bui/common"),d=c.namespace("Form"),e=b(a+"tips");return c.mix(d,{Tips:e,TipItem:e.Item,FieldContainer:b(a+"fieldcontainer"),Form:b(a+"form"),Row:b(a+"row"),Group:b(a+"fieldgroup"),HForm:b(a+"horizontal"),Rules:b(a+"rules"),Field:b(a+"field"),FieldGroup:b(a+"fieldgroup")}),d})}(),define("bui/form/tips",["bui/common","bui/overlay"],function(a){var b=a("bui/common"),c=b.prefix,d=a("bui/overlay").Overlay,e="data-tip",f=c+"form-tip-container",g=d.extend({initializer:function(){var a=this,b=a.get("render");if(!b){var c=$(a.get("trigger")).parent();a.set("render",c)}},renderUI:function(){var a=this;a.resetVisible()},resetVisible:function(){var a=this,b=$(a.get("trigger"));b.val()?a.set("visible",!1):(a.set("align",{node:$(a.get("trigger")),points:["cl","cl"]}),a.set("visible",!0))},bindUI:function(){var a=this,b=$(a.get("trigger"));a.get("el").on("click",function(){a.hide(),b.focus()}),b.on("click focus",function(){a.hide()}),b.on("blur",function(){a.resetVisible()})}},{ATTRS:{trigger:{},text:{},iconCls:{},tpl:{value:'<span class="{iconCls}"></span><span class="tip-text">{text}</span>'}}},{xclass:"form-tip"}),h=function(a){return this.constructor!==h?new h(a):(h.superclass.constructor.call(this,a),this._init(),void 0)};return h.ATTRS={form:{},items:{value:[]}},b.extend(h,b.Base),b.augment(h,{_init:function(){var a=this,c=$(a.get("form"));c.length&&(b.each($.makeArray(c[0].elements),function(b){var c=$(b).attr(e);c&&a._initFormElement(b,$.parseJSON(c))}),c.addClass(f))},_initFormElement:function(a,b){b&&(b.trigger=a);var c=this,d=c.get("items"),e=new g(b);d.push(e)},getItem:function(a){var c=this,d=c.get("items"),e=null;return b.each(d,function(b){return $(b.get("trigger")).attr("name")===a?(e=b,!1):void 0}),e},resetVisible:function(){var a=this,c=a.get("items");b.each(c,function(a){a.resetVisible()})},render:function(){var a=this,c=a.get("items");b.each(c,function(a){a.render()})},destroy:function(){var a=this,c=a.get(c);b.each(c,function(a){a.destroy()})}}),h.Item=g,h}),define("bui/form/basefield",["bui/common","bui/form/tips","bui/form/valid","bui/form/remote"],function(a){var b=a("bui/common"),c=b.Component,d=a("bui/form/tips").Item,e=a("bui/form/valid"),f=a("bui/form/remote"),g=b.prefix+"form-field-error",h=c.View.extend([f.View,e.View],{renderUI:function(){var a=this,b=a.get("control");if(b)a.set("controlContainer",b.parent());else{var c=a.get("controlTpl"),d=a.getControlContainer();if(c){var b=$(c).appendTo(d);a.set("control",b)}}},clearErrors:function(){var a=this,b=a.get("msgEl");b&&(b.remove(),a.set("msgEl",null)),a.get("el").removeClass(g)},showError:function(a,c){var d=this,e=d.get("control"),f=b.substitute(c,{error:a}),h=$(f);h.appendTo(e.parent()),d.set("msgEl",h),d.get("el").addClass(g)},getControlContainer:function(){var a=this,c=a.get("el"),d=a.get("controlContainer");return d&&b.isString(d)&&(d=c.find(d)),d&&d.length?d:c},getLoadingContainer:function(){return this.getControlContainer()},_uiSetName:function(a){var b=this;b.get("control").attr("name",a)}},{ATTRS:{error:{},controlContainer:{},msgEl:{},control:{}}}),i=c.Controller.extend([f,e],{initializer:function(){var a=this;a.on("afterRenderUI",function(){var b=a.get("tip");b&&(b.trigger=a.getTipTigger(),b.autoRender=!0,b=new d(b),a.set("tip",b))})},bindUI:function(){var a=this,b=a.get("validEvent"),c=a.get("changeEvent"),d=a.get("firstValidEvent"),e=a.getInnerControl();e.is("select")&&(b="change"),e.on(b,function(){var b=a.getControlValue(e);a.validControl(b)}),d&&e.on(d,function(){if(!a.get("hasValid")){var b=a.getControlValue(e);a.validControl(b)}}),a.on(c,function(){a.onValid()}),a.on("remotecomplete",function(b){a._setError(b.error)})},onValid:function(){var a=this,b=a.getControlValue();b=a.parseValue(b),a.isCurrentValue(b)||(a.setInternal("value",b),a.onChange())},onChange:function(){this.fire("change")},isCurrentValue:function(a){return a==this.get("value")},_clearError:function(){this.set("error",null),this.get("view").clearErrors()},_setError:function(a){this.set("error",a),this.showErrors()},getControlValue:function(a){var b=this;return a=a||b.getInnerControl(),a.val()},getControlContainer:function(){return this.get("view").getControlContainer()},getRemoteParams:function(){var a=this,b={};return b[a.get("name")]=a.getControlValue(),b},setControlValue:function(a){var b=this,c=b.getInnerControl();c.val(a)},parseValue:function(a){return a},valid:function(){var a=this;a.validControl()},validControl:function(a){var b,c=this;return a=a||c.getControlValue(),preError=c.get("error"),b=c.getValidError(a),c.setInternal("hasValid",!0),b?(c._setError(b),c.fire("error",{msg:b,value:a}),preError!==b&&c.fire("validchange",{valid:!1})):(c._clearError(),c.fire("valid"),preError&&c.fire("validchange",{valid:!0})),!b},focus:function(){this.getInnerControl().focus()},change:function(){var a=this.getInnerControl();a.change()},blur:function(){this.getInnerControl().blur()},isValid:function(){var a=this;return a.get("hasValid")||a.validControl(),!a.get("error")},getError:function(){return this.get("error")},getErrors:function(){var a=this.getError();return a?[a]:[]},clearErrors:function(a){var b=this;b._clearError(),a&&b.getControlValue()!=b.get("value")&&b.setControlValue(b.get("value"))},getInnerControl:function(){return this.get("view").get("control")},getTipTigger:function(){return this.getInnerControl()},destructor:function(){var a=this,b=a.get("tip");b&&b.destroy&&b.destroy()},setInnerWidth:function(a){var b=this,c=b.getInnerControl(),d=c.outerWidth()-c.width();c.width(a-d)},_resetTip:function(){var a=this,b=a.get("tip");b&&b.resetVisible()},resetTip:function(){this._resetTip()},_uiSetValue:function(a){var b=this;b.setControlValue(a),b.get("rendered")&&(b.validControl(),b.onChange()),b._resetTip()},_uiSetDisabled:function(a){var c=this,d=c.getInnerControl(),e=c.get("children");d.attr("disabled",a),c.get("rendered")&&(a&&c.clearErrors(),a||c.valid()),b.each(e,function(b){b.set("disabled",a)})},_uiSetWidth:function(a){var b=this;null!=a&&b.get("forceFit")&&b.setInnerWidth(a)}},{ATTRS:{hasValid:{value:!1},forceFit:{value:!1},tip:{},changeEvent:{value:"valid"},firstValidEvent:{value:"blur"},validEvent:{value:"keyup change"},name:{view:!0},showError:{view:!0,value:!0},value:{view:!0},label:{},controlContainer:{view:!0},control:{view:!0},controlTpl:{view:!0,value:'<input type="text"/>'},events:{value:{error:!1,valid:!1,change:!0,validchange:!0}},tpl:{value:"<label>{label}</label>"},xview:{value:h}},PARSER:{control:function(a){var b=a.find("input,select,textarea");return b.length?b:a},disabled:function(a){return!!a.attr("disabled")},value:function(a){var b=this,c="select,input,textarea",d=b.get("value");return d||(a.is(c)?(d=a.val(),!d&&a.is("select")&&(d=a.attr("value"))):d=a.find(c).val()),d},name:function(a){var b=this,c="select,input,textarea",d=b.get("name");return d||(d=a.is(c)?a.attr("name"):a.find(c).attr("name")),d}}},{xclass:"form-field"});return i.View=h,i}),define("bui/form/textfield",["bui/form/basefield"],function(a){var b=a("bui/form/basefield"),c=b.extend({},{xclass:"form-field-text"});return c}),define("bui/form/numberfield",["bui/form/basefield"],function(a){var b=a("bui/form/basefield"),c=b.extend({parseValue:function(a){if(""==a||null==a)return null;if(BUI.isNumber(a))return a;var b=this,c=b.get("allowDecimals");return a=a.replace(/\,/g,""),c?parseFloat(parseFloat(a).toFixed(b.get("decimalPrecision"))):parseInt(a,10)},_uiSetMax:function(a){this.addRule("max",a)},_uiSetMin:function(a){this.addRule("min",a)}},{ATTRS:{max:{},min:{},decorateCfgFields:{value:{min:!0,max:!0}},validEvent:{value:"keyup change"},defaultRules:{value:{number:!0}},allowDecimals:{value:!0},decimalPrecision:{value:2},step:{value:1}}},{xclass:"form-field-number"});return c}),define("bui/form/hiddenfield",["bui/form/basefield"],function(a){var b=a("bui/form/basefield"),c=b.extend({},{ATTRS:{controlTpl:{value:'<input type="hidden"/>'},tpl:{value:""}}},{xclass:"form-field-hidden"});return c}),define("bui/form/readonlyfield",["bui/form/basefield"],function(a){var b=a("bui/form/basefield"),c=b.extend({},{ATTRS:{controlTpl:{value:'<input type="text" readonly="readonly"/>'}}},{xclass:"form-field-readonly"});return c}),define("bui/form/selectfield",["bui/common","bui/form/basefield"],function(a){function b(a,b,e){a.children().remove();var f=e.get("emptyText");f&&e.get("showBlank")&&c("",f,a),d.each(b,function(b){c(b.value,b.text,a)})}function c(a,b,c){var d='<option value="'+a+'">'+b+"</option>";$(d).appendTo(c)}var d=a("bui/common"),e=a("bui/form/basefield"),f=e.extend({renderUI:function(){var a=this,b=a.getInnerControl(),c=a.get("select");a.get("srcNode")&&b.is("select")||$.isPlainObject(c)&&a._initSelect(c)},_initSelect:function(a){var b=this;b.get("items"),d.use("bui/select",function(c){a.render=b.getControlContainer(),a.valueField=b.getInnerControl(),a.autoRender=!0,a=new c.Select(a),b.set("select",a),b.set("isCreate",!0),b.get("children").push(a),a.on("change",function(){var c=a.getSelectedValue();b.set("value",c)})})},setItems:function(a){var c=this,e=c.get("select");if($.isPlainObject(a)){var f=[];d.each(a,function(a,b){f.push({value:b,text:a})}),a=f}var g=c.getInnerControl();g.is("select")&&(b(g,a,c),c.setControlValue(c.get("value")),c.getControlValue()||c.setInternal("value","")),e&&(e.set?e.set("items",a):e.items=a)},setControlValue:function(a){var b=this,c=b.get("select"),d=b.getInnerControl();d.val(a),c&&c.set&&c.getSelectedValue()!==a&&c.setSelectedValue(a)},getSelectedText:function(){var a=this,b=a.get("select"),c=a.getInnerControl();if(c.is("select")){var d=c[0],e=d.options[d.selectedIndex];return e?e.text:""}return b.getSelectedText()},getTipTigger:function(){var a=this,b=a.get("select");return b&&b.rendered?b.get("el").find("input"):a.get("el")},_uiSetItems:function(a){a&&this.setItems(a)},setInnerWidth:function(a){var b=this,c=b.getInnerControl(),d=b.get("select"),e=c.outerWidth()-c.width();c.width(a-e),d&&d.set&&d.set("width",a)}},{ATTRS:{items:{},controlTpl:{value:'<input type="hidden"/>'},showBlank:{value:!0},emptyText:{value:"\u8bf7\u9009\u62e9"},select:{value:{}}},PARSER:{emptyText:function(a){if(!this.get("showBlank"))return"";var b=a.find("option"),c=this.get("emptyText");return b.length&&(c=$(b[0]).text()),c}}},{xclass:"form-field-select"});return f}),define("bui/form/datefield",["bui/common","bui/form/basefield","bui/calendar"],function(a){var b=a("bui/common"),c=a("bui/form/basefield"),d=b.Date,e=a("bui/calendar").DatePicker,f=c.extend({renderUI:function(){var a=this,b=a.get("datePicker");$.isPlainObject(b)&&(b.trigger=a.getInnerControl(),b.autoRender=!0,b=new e(b),a.set("datePicker",b),a.set("isCreatePicker",!0),a.get("children").push(b)),b.get("showTime")&&a.getInnerControl().addClass("calendar-time")},bindUI:function(){var a=this;a.get("datePicker")},setControlValue:function(a){var c=this,e=c.getInnerControl();b.isDate(a)&&(a=d.format(a,c._getFormatMask())),e.val(a)},_getFormatMask:function(){var a=this,b=a.get("datePicker");return b.get("showTime")?"yyyy-mm-dd HH:MM:ss":"yyyy-mm-dd"},parseValue:function(a){return b.isNumber(a)?new Date(a):d.parse(a)},isCurrentValue:function(a){return d.isEquals(a,this.get("value"))},_uiSetMax:function(a){this.addRule("max",a);var b=this,c=b.get("datePicker");c&&c.set&&c.set("maxDate",a)},_uiSetMin:function(a){this.addRule("min",a);var b=this,c=b.get("datePicker");c&&c.set&&c.set("minDate",a)}},{ATTRS:{controlTpl:{value:'<input type="text" class="calendar"/>'},defaultRules:{value:{date:!0}},max:{},min:{},value:{setter:function(a){return b.isNumber(a)?new Date(a):a}},datePicker:{value:{}},isCreatePicker:{value:!0}},PARSER:{datePicker:function(a){return a.hasClass("calendar-time")?{showTime:!0}:{}}}},{xclass:"form-field-date"});return f}),define("bui/form/checkfield",["bui/form/basefield"],function(a){var b=a("bui/form/basefield"),c=b.extend({onValid:function(){var a=this,b=a._getControlChecked();a.setInternal("checked",b),a.fire("change"),b?a.fire("checked"):a.fire("unchecked")},_setControlChecked:function(a){var b=this,c=b.getInnerControl();c.attr("checked",!!a)},_getControlChecked:function(){var a=this,b=a.getInnerControl();return!!b.attr("checked")},_uiSetValue:function(){},_uiSetWidth:function(){},_uiSetChecked:function(a){var b=this;b._setControlChecked(a),b.get("rendered")&&b.onValid()}},{ATTRS:{validEvent:{value:"click"},checked:{value:!1},events:{value:{checked:!1,unchecked:!1}}},PARSER:{checked:function(a){return!!a.attr("checked")}}},{xclass:"form-check-field"});return c}),define("bui/form/checkboxfield",["bui/form/checkfield"],function(a){var b=a("bui/form/checkfield"),c=b.extend({},{ATTRS:{controlTpl:{view:!0,value:'<input type="checkbox"/>'},controlContainer:{value:".checkbox"},tpl:{value:'<label><span class="checkbox"></span>{label}</label>'}}},{xclass:"form-field-checkbox"});return c}),define("bui/form/radiofield",["bui/form/checkfield"],function(a){var b=a("bui/form/checkfield"),c=b.extend({bindUI:function(){var a=this,b=a.get("parent"),c=a.get("name");b&&a.getInnerControl().on("click",function(){var d=b.getFields(c);BUI.each(d,function(b){b!=a&&b.set("checked",!1)})})}},{ATTRS:{controlTpl:{view:!0,value:'<input type="radio"/>'},controlContainer:{value:".radio"},tpl:{value:'<label><span class="radio"></span>{label}</label>'}}},{xclass:"form-field-radio"});return c}),define("bui/form/plainfield",["bui/form/basefield"],function(a){var b=a("bui/form/basefield"),c=b.View.extend({_uiSetValue:function(a){var b,c=this,d=c.get("textEl"),e=c.getControlContainer(),f=c.get("renderer"),g=f?f(a):a,h=c.get("width"),i=0;d&&d.remove(),g=g||"&nbsp;",b=BUI.substitute(c.get("textTpl"),{text:g}),d=$(b).appendTo(e),i=d.outerWidth()-d.width(),d.width(h-i),c.set("textEl",d)}},{ATTRS:{textEl:{},value:{}}},{xclass:"form-field-plain-view"}),d=b.extend({},{ATTRS:{controlTpl:{value:'<input type="hidden"/>'},textTpl:{view:!0,value:'<span class="x-form-text">{text}</span>'},renderer:{view:!0,value:function(a){return a}},tpl:{value:""},xview:{value:c}}},{xclass:"form-field-plain"});return d}),function(){var a="bui/form/";define(a+"field",["bui/common",a+"textfield",a+"datefield",a+"selectfield",a+"hiddenfield",a+"numberfield",a+"checkfield",a+"radiofield",a+"checkboxfield",a+"plainfield",a+"listfield",a+"checklistfield",a+"radiolistfield"],function(b){var c=b("bui/common"),d=b(a+"basefield");return c.mix(d,{Text:b(a+"textfield"),Date:b(a+"datefield"),Select:b(a+"selectfield"),Hidden:b(a+"hiddenfield"),Number:b(a+"numberfield"),Check:b(a+"checkfield"),Radio:b(a+"radiofield"),Checkbox:b(a+"checkboxfield"),Plain:b(a+"plainfield"),List:b(a+"listfield"),Uploader:b(a+"uploaderfield"),CheckList:b(a+"checklistfield"),RadioList:b(a+"radiolistfield")}),d})}(),define("bui/form/valid",["bui/common","bui/form/rules"],function(a){var b=a("bui/common"),c=a("bui/form/rules"),d=function(){};d.prototype={getErrorsContainer:function(){var a=this,c=a.get("errorContainer");return c?b.isString(c)?a.get("el").find(c):c:a.getContentElement()},showErrors:function(a){var c=this,d=c.getErrorsContainer(),e=c.get("errorTpl");return c.clearErrors(),c.get("showError")?c.get("showOneError")?(a&&a.length&&c.showError(a[0],e,d),void 0):(b.each(a,function(a){a&&c.showError(a,e,d)}),void 0):void 0},showError:function(){},clearErrors:function(){}};var e=function(){};return e.ATTRS={defaultRules:{value:{}},defaultMessages:{value:{}},rules:{value:{}},messages:{value:{}},validator:{},errorContainer:{view:!0},errorTpl:{view:!0,value:'<span class="x-field-error"><span class="x-icon x-icon-mini x-icon-error">!</span><label class="x-field-error-text">{error}</label></span>'},showError:{view:!0,value:!0},showOneError:{},error:{}},e.prototype={__bindUI:function(){var a=this;a.on("afterDisabledChange",function(b){var c=b.newVal;c?a.clearErrors(!1):a.valid()})},isValid:function(){},valid:function(){},validControl:function(){},validRules:function(a,b){var d=this,e=d._getValidMessages(),f=null;for(var g in a)if(a.hasOwnProperty(g)){var h=a[g];if(f=c.valid(g,b,h,e[g],d))break}return f},_getValidMessages:function(){var a=this,c=a.get("defaultMessages"),d=a.get("messages");return b.merge(c,d)},getValidError:function(a){var b=this,c=b.get("validator"),d=null;return d=b.validRules(b.get("defaultRules"),a)||b.validRules(b.get("rules"),a),d||(b.parseValue&&(a=b.parseValue(a)),d=c?c.call(this,a):""),d},getErrors:function(){},showErrors:function(a){var b=this,a=a||b.getErrors();b.get("view").showErrors(a)},clearErrors:function(a){a=null==a?!0:a;var c=this,d=c.get("children");a&&b.each(d,function(a){a.clearErrors&&a.clearErrors()}),c.set("error",null),c.get("view").clearErrors()},addRule:function(a,b,c){var d=this,e=d.get("rules"),f=d.get("messages");e[a]=b,c&&(f[a]=c)},addRules:function(a,c){var d=this;b.each(a,function(a,b){var e=c?c[b]:null;d.addRule(b,a,e)})},removeRule:function(a){var b=this,c=b.get("rules");delete c[a]},clearRules:function(){var a=this;a.set("rules",{})}},e.View=d,e}),define("bui/form/groupvalid",["bui/form/valid"],function(a){function b(){}function c(){}var d="x-form-error",e=a("bui/form/valid");return BUI.augment(b,e.View,{showError:function(a,b,c){var e=BUI.substitute(b,{error:a}),f=$(e);f.appendTo(c),f.addClass(d)},clearErrors:function(){var a=this,b=a.getErrorsContainer();b.children("."+d).remove()}}),c.ATTRS=ATTRS=BUI.merge(!0,e.ATTRS,{events:{value:{validchange:!0,change:!0}}}),BUI.augment(c,e,{__bindUI:function(){var a=this,b="validchange change";a.on(b,function(b){var c=b.target;if(c!=this&&a.get("showError")){var d=a.isChildrenValid();d&&(a.validControl(a.getRecord()),d=a.isSelfValid()),d?a.clearErrors():a.showErrors()}})},isValid:function(){if(this.get("disabled"))return!0;var a=this,b=a.isChildrenValid();return b&&a.isSelfValid()},valid:function(){var a=this,b=a.get("children");a.get("disabled")||BUI.each(b,function(a){a.get("disabled")||a.valid()})},isChildrenValid:function(){var a=this,b=a.get("children"),c=!0;return BUI.each(b,function(a){return a.get("disabled")||a.isValid()?void 0:(c=!1,!1)}),c},isSelfValid:function(){return!this.get("error")},validControl:function(a){var b=this,c=b.getValidError(a);b.set("error",c)},getErrors:function(){var a=this,b=a.get("children"),c=a.get("showChildError"),d=null,e=[];return c&&BUI.each(b,function(a){a.getErrors&&(e=e.concat(a.getErrors()))}),a.isChildrenValid()&&(d=a.get("error"),d&&e.push(d)),e},_uiSetErrorTpl:function(a){var b=this,c=b.get("children");BUI.each(c,function(b){b.set("errorTpl",a)})}}),c.View=b,c}),define("bui/form/fieldcontainer",["bui/common","bui/form/field","bui/form/groupvalid"],function(a){function b(a){return a.is(k)}function c(a,e){if(a!=e){if(b(a))return[a];var f=a.attr("class");if(f&&(-1!==f.indexOf(j)||-1!==f.indexOf(i)))return[a]}var g=[],h=a.children();return d.each(h,function(a){g=g.concat(c($(a),e))}),g}var d=a("bui/common"),e=a("bui/form/field"),f=a("bui/form/groupvalid"),g=d.prefix,h="form-field",i=g+h,j=g+"form-group",k="input,select,textarea",l=d.Component.View.extend([f.View]),m=d.Component.Controller.extend([f],{syncUI:function(){var a=this,b=a.getFields(),c=a.get("validators");d.each(b,function(a){var b=a.get("name");c[b]&&a.set("validator",c[b])}),d.each(c,function(b,c){if(0==c.indexOf("#")){var d=c.replace("#",""),e=a.getChild(d,!0);e&&e.set("validator",b)}})},getDecorateElments:function(){var a=this,b=a.get("el"),d=c(b,b);return d},findXClassByNode:function(a,c){return"checkbox"===a.attr("type")?h+"-checkbox":"radio"===a.attr("type")?h+"-radio":"number"===a.attr("type")?h+"-number":a.hasClass("calendar")?h+"-date":"SELECT"==a[0].tagName?h+"-select":b(a)?h:d.Component.Controller.prototype.findXClassByNode.call(this,a,c)},getRecord:function(){var a=this,b={},c=a.getFields();return d.each(c,function(c){var e=c.get("name"),f=a._getFieldValue(c);if(b[e]){if(d.isArray(b[e])&&null!=f)b[e].push(f);else if(null!=f){var g=[b[e]];g.push(f),b[e]=g}}else b[e]=f}),b},getFields:function(a){var b=this,c=[],f=b.get("children");return d.each(f,function(b){b instanceof e?a&&b.get("name")!=a||c.push(b):b.getFields&&(c=c.concat(b.getFields(a)))}),c},getField:function(a){var b=this,c=b.getFields(),e=null;return d.each(c,function(b){return b.get("name")===a?(e=b,!1):void 0}),e},getFieldAt:function(a){return this.getFields()[a]},setFieldValue:function(a,b){var c=this,e=c.getFields(a);d.each(e,function(a){c._setFieldValue(a,b)})},_setFieldValue:function(a,b){if(!a.get("disabled"))if(a instanceof e.Check){var c=a.get("value");b&&(c===b||d.isArray(b)&&d.Array.contains(c,b))?a.set("checked",!0):a.set("checked",!1)}else null==b&&(b=""),a.set("value",b)},getFieldValue:function(a){var b=this,c=b.getFields(a),e=[];return d.each(c,function(a){var c=b._getFieldValue(a);c&&e.push(c)}),0===e.length?null:1===e.length?e[0]:e},_getFieldValue:function(a){return a instanceof e.Check&&!a.get("checked")?null:a.get("value")},clearFields:function(){this.clearErrors(),this.setRecord({})},setRecord:function(a){var b=this,c=b.getFields();d.each(c,function(c){var d=c.get("name");b._setFieldValue(c,a[d])})},updateRecord:function(a){var b=this,c=b.getFields();d.each(c,function(c){var d=c.get("name");a.hasOwnProperty(d)&&b._setFieldValue(c,a[d])})},focus:function(){var a=this,b=a.getFields(),c=b[0];c&&c.focus()},_uiSetDisabled:function(a){var b=this,c=b.get("children");d.each(c,function(b){b.set("disabled",a)})}},{ATTRS:{record:{setter:function(a){this.setRecord(a)},getter:function(){return this.getRecord()}},validators:{value:{}},defaultLoaderCfg:{value:{property:"children",dataType:"json"}},disabled:{sync:!1},isDecorateChild:{value:!0},xview:{value:l}}},{xclass:"form-field-container"});return m.View=l,m}),define("bui/form/group/base",["bui/common","bui/form/fieldcontainer"],function(a){var b=(a("bui/common"),a("bui/form/fieldcontainer")),c=b.extend({},{ATTRS:{label:{view:!0},defaultChildClass:{value:"form-field"}}},{xclass:"form-group"});return c}),define("bui/form/group/range",["bui/form/group/base"],function(a){function b(a,b,c){var d=a.get("allowEqual");return d?b>=c:b>c}var c=a("bui/form/group/base"),d=c.extend({},{ATTRS:{rangeText:{value:"\u5f00\u59cb\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\uff01"},allowEqual:{value:!0},validator:{value:function(){for(var a=this,c=a.getFields(),d=!0,e=1;e<c.length;e++){var f,g,h=c[e],i=c[e-1];if(h&&i&&(f=h.get("value"),g=i.get("value"),!b(a,f,g))){d=!1;break}}return d?null:a.get("rangeText")}}}},{xclass:"form-group-range"});return d}),define("bui/form/group/check",["bui/form/group/base"],function(a){function b(a){var b=a.getFieldAt(0);return b?b.get("name"):""}var c=a("bui/form/group/base"),d=c.extend({bindUI:function(){var a=this;a.on("change",function(){var c=b(a),d=a.get("range"),e=a.getRecord(),f=e[c],g=d[1];f&&f.length>=g?a._setFieldsEnable(c,!1):a._setFieldsEnable(c,!0)})},_setFieldsEnable:function(a,b){var c=this,d=c.getFields(a);BUI.each(d,function(a){b?a.enable():a.get("checked")||a.disable()})},_uiSetRange:function(a){this.addRule("checkRange",a)}},{ATTRS:{range:{setter:function(a){return(BUI.isString(a)||BUI.isNumber(a))&&(a=[parseInt(a,10)]),a}}}},{xclass:"form-group-check"});return d}),define("bui/form/group/select",["bui/form/group/base","bui/data"],function(a){function b(a){var b=[];return BUI.each(a,function(a){b.push({text:a.text,value:a.id})}),b}var c=a("bui/form/group/base"),d=a("bui/data"),e=BUI.Component.UIBase.Bindable,f=c.extend([e],{initializer:function(){var a=this,b=a.get("url"),c=a.get("store")||a._getStore();c.isStore||(c.autoLoad=!0,b&&(c.url=b),c=new d.TreeStore(c),a.set("store",c))},bindUI:function(){var a=this;a.on("change",function(b){var c=b.target;if(c!=a){var d=c,e=d.get("value"),f=a._getFieldIndex(d)+1;a._valueChange(e,f)}})},onLoad:function(a){var b=this,c=a?a.node:b.get("store").get("root");b._setFieldItems(c.level,c.children)},_getStore:function(){var a=this,b=a.get("type");return b&&g[b]?g[b]:{}},_valueChange:function(a,b){var c=this,d=c.get("store");if(a){var e=d.findNode(a);if(!e)return;d.isLoaded(e)?c._setFieldItems(b,e.children):d.loadNode(e)}else c._setFieldItems(b,[])},_setFieldItems:function(a,c){var d=this,e=d.getFieldAt(a),f=b(c);e&&(e.setItems(f),d._valueChange(e.get("value"),a+1))},_getFieldIndex:function(a){var b=this,c=b.getFields();return BUI.Array.indexOf(a,c)}},{ATTRS:{type:{},store:{}}},{xclass:"form-group-select"}),g={};return f.addType=function(a,b){g[a]=b},f.addType("city",{proxy:{url:"http://lp.taobao.com/go/rgn/citydistrictdata.php",dataType:"jsonp"},map:{isleaf:"leaf",value:"text"}}),f}),define("bui/form/fieldgroup",["bui/common","bui/form/group/base","bui/form/group/range","bui/form/group/check","bui/form/group/select"],function(a){var b=a("bui/common"),c=a("bui/form/group/base");return b.mix(c,{Range:a("bui/form/group/range"),Check:a("bui/form/group/check"),Select:a("bui/form/group/select")}),c}),define("bui/form/form",["bui/common","bui/toolbar","bui/form/fieldcontainer"],function(a){var b=a("bui/common"),c=a("bui/toolbar").Bar,d={NORMAL:"normal",AJAX:"ajax",IFRAME:"iframe"},e=a("bui/form/fieldcontainer");b.Component;var f=e.View.extend({_uiSetMethod:function(a){this.get("el").attr("method",a)},_uiSetAction:function(a){this.get("el").attr("action",a)}},{ATTRS:{method:{},action:{}}},{xclass:"form-view"}),g=e.extend({renderUI:function(){var a,d=this,e=d.get("buttonBar");$.isPlainObject(e)&&d.get("buttons")&&(a=b.merge(d.getDefaultButtonBarCfg(),e),e=new c(a),d.set("buttonBar",e)),d._initSubmitMask()},bindUI:function(){var a=this,b=a.get("el");b.on("submit",function(b){return a.valid(),a.isValid()&&a.onBeforeSubmit()!==!1?(a.isValid()&&a.get("submitType")===d.AJAX&&(b.preventDefault(),a.ajaxSubmit()),void 0):(b.preventDefault(),void 0)})},getDefaultButtonBarCfg:function(){var a=this,b=a.get("buttons");return{autoRender:!0,elCls:"toolbar",render:a.get("el"),items:b,defaultChildClass:"bar-item-button"}},submit:function(a){var b=this,c=b.get("submitType");if(b.valid(),b.isValid()){if(0==b.onBeforeSubmit())return;c===d.NORMAL?b.get("el")[0].submit():c===d.AJAX&&b.ajaxSubmit(a)}},ajaxSubmit:function(a){var c,d=this,e=d.get("method"),f=d.get("action"),g=d.get("callback"),h=d.get("submitMask"),i=d.serializeToObject(),j=b.merge(!0,{url:f,type:e,dataType:"json",data:i},a);a&&a.success&&(c=a.success),j.success=function(a){h&&h.hide&&h.hide(),c&&c(a),g&&g.call(d,a)},h&&h.show&&h.show(),$.ajax(j)},_initSubmitMask:function(){var a=this,c=a.get("submitType"),e=a.get("submitMask");c===d.AJAX&&e&&b.use("bui/mask",function(c){var d=$.isPlainObject(e)?e:{};e=new c.LoadMask(b.mix({el:a.get("el")},d)),a.set("submitMask",e)})},serializeToObject:function(){return b.FormHelper.serializeToObject(this.get("el")[0])},onBeforeSubmit:function(){return this.fire("beforesubmit")},reset:function(){var a=this,b=a.get("initRecord");a.setRecord(b)},resetTips:function(){var a=this,c=a.getFields();b.each(c,function(a){a.resetTip()})},destructor:function(){var a=this,b=a.get("buttonBar"),c=a.get("submitMask");b&&b.destroy&&b.destroy(),c&&c.destroy&&c.destroy()},_uiSetInitRecord:function(a){this.setRecord(a)}},{ATTRS:{action:{view:!0,value:""},allowTextSelection:{value:!0},events:{value:{beforesubmit:!1}},method:{view:!0,value:"get"},defaultLoaderCfg:{value:{autoLoad:!0,property:"record",dataType:"json"}},submitMask:{value:{msg:"\u6b63\u5728\u63d0\u4ea4\u3002\u3002\u3002"}},submitType:{value:"normal"},callback:{},decorateCfgFields:{value:{method:!0,action:!0}},defaultChildClass:{value:"form-field"},elTagName:{value:"form"},buttons:{},buttonBar:{value:{}},childContainer:{value:".x-form-fields"},initRecord:{},showError:{value:!1},xview:{value:f},tpl:{value:'<div class="x-form-fields"></div>'}}},{xclass:"form"});return g.View=f,g}),define("bui/form/horizontal",["bui/common","bui/form/form"],function(a){var b=(a("bui/common"),a("bui/form/form")),c=b.extend({getDefaultButtonBarCfg:function(){var a=this,b=a.get("buttons");return{autoRender:!0,elCls:"actions-bar toolbar row",tpl:'<div class="form-actions span21 offset3"></div>',childContainer:".form-actions",render:a.get("el"),items:b,defaultChildClass:"bar-item-button"}}},{ATTRS:{defaultChildClass:{value:"form-row"},errorTpl:{value:'<span class="valid-text"><span class="estate error"><span class="x-icon x-icon-mini x-icon-error">!</span><em>{error}</em></span></span>'},elCls:{value:"form-horizontal"}},PARSER:{}},{xclass:"form-horizontal"});return c}),define("bui/form/row",["bui/common","bui/form/fieldcontainer"],function(a){var b=(a("bui/common"),a("bui/form/fieldcontainer")),c=b.extend({},{ATTRS:{elCls:{value:"row"},defaultChildCfg:{value:{tpl:' <label class="control-label">{label}</label>                <div class="controls">                </div>',childContainer:".controls",showOneError:!0,controlContainer:".controls",elCls:"control-group span8",errorTpl:'<span class="valid-text"><span class="estate error"><span class="x-icon x-icon-mini x-icon-error">!</span><em>{error}</em></span></span>'}},defaultChildClass:{value:"form-field-text"}}},{xclass:"form-row"});return c}),define("bui/form/rule",["bui/common"],function(a){function b(a,b,c,f,g){e.isArray(c)&&e.isString(c[1])&&(c[1]&&(f=c[1]),c=c[0]);var h=a,i=h.get("validator"),j=d(a,c,f);return b=null==b?"":b,i.call(h,b,c,j,g)}function c(a){if(null==a)return{};if($.isPlainObject(a))return a;var b=a,c={};if(e.isArray(a)){for(var d=0;d<b.length;d++)c[d]=b[d];return c}return{0:a}}function d(a,b,d){var f=c(b);return d=d||a.get("msg"),e.substitute(d,f)}var e=a("bui/common"),f=function(a){f.superclass.constructor.call(this,a)};return e.extend(f,e.Base),f.ATTRS={name:{},msg:{},validator:{value:function(){}}},e.augment(f,{valid:function(a,c,d,e){var f=this;return b(f,a,c,d,e)}}),f}),define("bui/form/rules",["bui/form/rule"],function(a){function b(a){return parseFloat(a)}function c(a){return BUI.Date.parse(a)}function d(a,b,c){var d=a&&a.equals!==!1;return d?b>=c:b>c}function e(a){return""==a||null==a}function f(a,b,c,f){for(var g=f.getFields(),h=!0,i=1;i<g.length;i++){var j,k,l=g[i],m=g[i-1];if(l&&m&&(j=l.get("value"),k=m.get("value"),!e(j)&&!e(k)&&!d(b,j,k))){h=!1;break}}return h?null:c}function g(a){var b=a.getFieldAt(0);return b?b.get("name"):""}function h(a,b){if(BUI.isArray(b)||(b=[b]),!a||!b.length)return!1;var c=a?BUI.isArray(a)?a.length:1:0;if(1==b.length){var d=b[0];if(!d)return!0;if(d>c)return!1}else{var e=b[0],f=b[1];if(e>c||c>f)return!1}return!0}var i=a("bui/form/rule"),j={},k={add:function(a){var b;return $.isPlainObject(a)?(b=a.name,j[b]=new i(a)):a.get&&(b=a.get("name"),j[b]=a),j[b]},remove:function(a){delete j[a]},get:function(a){return j[a]},valid:function(a,b,c,d,e){var f=k.get(a);return f?f.valid(b,c,d,e):null},isValid:function(a,b,c,d){return null==k.valid(a,b,c,d)}};return k.add({name:"required",msg:"\u4e0d\u80fd\u4e3a\u7a7a\uff01",validator:function(a,b,c){return b!==!1&&/^\s*$/.test(a)?c:void 0}}),k.add({name:"equalTo",msg:"\u4e24\u6b21\u8f93\u5165\u4e0d\u4e00\u81f4\uff01",validator:function(a,b,c){var d=$(b);return d.length&&(b=d.val()),a===b?void 0:c}}),k.add({name:"min",msg:"\u8f93\u5165\u503c\u4e0d\u80fd\u5c0f\u4e8e{0}\uff01",validator:function(a,c,d){return""!==a&&b(a)<b(c)?d:void 0}}),k.add({name:"max",msg:"\u8f93\u5165\u503c\u4e0d\u80fd\u5927\u4e8e{0}\uff01",validator:function(a,c,d){return""!==a&&b(a)>b(c)?d:void 0}}),k.add({name:"length",msg:"\u8f93\u5165\u503c\u957f\u5ea6\u4e3a{0}\uff01",validator:function(a,b,c){return null!=a&&(a=$.trim(a.toString()),b!=a.length)?c:void 0}}),k.add({name:"minlength",msg:"\u8f93\u5165\u503c\u957f\u5ea6\u4e0d\u5c0f\u4e8e{0}\uff01",validator:function(a,b,c){if(null!=a){a=$.trim(a.toString());var d=a.length;if(b>d)return c}}}),k.add({name:"maxlength",msg:"\u8f93\u5165\u503c\u957f\u5ea6\u4e0d\u5927\u4e8e{0}\uff01",validator:function(a,b,c){if(a){a=$.trim(a.toString());var d=a.length;if(d>b)return c}}}),k.add({name:"regexp",msg:"\u8f93\u5165\u503c\u4e0d\u7b26\u5408{0}\uff01",validator:function(a,b,c){return b?b.test(a)?void 0:c:void 0}}),k.add({name:"email",msg:"\u4e0d\u662f\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740\uff01",validator:function(a,b,c){return a=$.trim(a),a?/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a)?void 0:c:void 0}}),k.add({name:"date",msg:"\u4e0d\u662f\u6709\u6548\u7684\u65e5\u671f\uff01",validator:function(a,b,c){return BUI.isNumber(a)||BUI.isDate(a)?void 0:(a=$.trim(a),a?BUI.Date.isDateString(a)?void 0:c:void 0)}}),k.add({name:"minDate",msg:"\u8f93\u5165\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e{0}\uff01",validator:function(a,b,d){if(a){var e=c(a);
if(e&&e<c(b))return d}}}),k.add({name:"maxDate",msg:"\u8f93\u5165\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e{0}\uff01",validator:function(a,b,d){if(a){var e=c(a);if(e&&e>c(b))return d}}}),k.add({name:"number",msg:"\u4e0d\u662f\u6709\u6548\u7684\u6570\u5b57\uff01",validator:function(a,b,c){return BUI.isNumber(a)?void 0:(a=a.replace(/\,/g,""),isNaN(a)?c:void 0)}}),k.add({name:"dateRange",msg:"\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u8d77\u59cb\u65e5\u671f\uff01",validator:f}),k.add({name:"numberRange",msg:"\u7ed3\u675f\u6570\u5b57\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u6570\u5b57\uff01",validator:f}),k.add({name:"checkRange",msg:"\u5fc5\u987b\u9009\u4e2d{0}\u9879\uff01",validator:function(a,b,c,d){var e,f=g(d),i=b;return f&&i&&(e=a[f],!h(e,i))?c:null}}),k}),define("bui/form/remote",["bui/common"],function(a){var b=a("bui/common"),c=function(){};c.ATTRS={isLoading:{},loadingEl:{}},c.prototype={getLoadingContainer:function(){},_setLoading:function(){var a=this,b=a.get("loadingEl"),c=a.get("loadingTpl");b||(b=$(c).appendTo(a.getLoadingContainer()),a.setInternal("loadingEl",b))},_clearLoading:function(){var a=this,b=a.get("loadingEl");b&&(b.remove(),a.setInternal("loadingEl",null))},_uiSetIsLoading:function(a){var b=this;a?b._setLoading():b._clearLoading()}};var d=function(){};return d.ATTRS={defaultRemote:{value:{method:"GET",cache:!0,callback:function(a){return a}}},remoteDaly:{value:500},cacheMap:{value:{}},loadingTpl:{view:!0,value:'<img src="http://img02.taobaocdn.com/tps/i2/T1NU8nXCVcXXaHNz_X-16-16.gif" alt="loading"/>'},isLoading:{view:!0,value:!1},remote:{setter:function(a){return b.isString(a)&&(a={url:a}),a}},remoteHandler:{},events:{value:{remotecomplete:!1,remotestart:!1}}},d.prototype={__bindUI:function(){var a=this;a.on("valid",function(){if(a.get("remote")&&a.isValid()){var b=a.getControlValue(),c=a.getRemoteParams();a._startRemote(c,b)}}),a.on("error",function(){a.get("remote")&&a._cancelRemote()})},_startRemote:function(a,b){function c(){d._remoteValid(a,e,b),d.set("isLoading",!0)}var d=this,e=d.get("remoteHandler"),f=d.get("cacheMap"),g=d.get("remoteDaly");return e&&d._cancelRemote(e),null!=f[b]?(d._validResult(d._getCallback(),f[b]),void 0):(e=setTimeout(c,g),d.setInternal("remoteHandler",e),void 0)},_validResult:function(a,b){var c=this,d=a(b);c.onRemoteComplete(d,b)},onRemoteComplete:function(a,b,c){var d=this;c==d.get("remoteHandler")&&(d.fire("remotecomplete",{error:a,data:b}),d.set("isLoading",!1),d.setInternal("remoteHandler",null))},_getOptions:function(a){var c=this,d=c.get("remote"),e=c.get("defaultRemote"),f=b.merge(e,d,{data:a});return f},_getCallback:function(){return this._getOptions().callback},_remoteValid:function(a,b,c){var d=this,e=d.get("cacheMap"),f=d._getOptions(a);f.success=function(a){var g=f.callback,h=g(a);e[c]=a,d.onRemoteComplete(h,a,b)},f.error=function(a,c,e){d.onRemoteComplete(e,null,b)},d.fire("remotestart",{data:a}),$.ajax(f)},getRemoteParams:function(){},_cancelRemote:function(a){var b=this;a=a||b.get("remoteHandler"),a&&(clearTimeout(a),b.setInternal("remoteHandler",null)),b.set("isLoading",!1)}},d.View=c,d});