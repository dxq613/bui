/*! BUI - v0.1.0 - 2013-11-18
* https://github.com/dxq613/bui
* Copyright (c) 2013 dxq613; Licensed MIT */
define("bui/select",["bui/common","bui/select/select","bui/select/combox","bui/select/suggest"],function(a){var b=a("bui/common"),c=b.namespace("Select");return b.mix(c,{Select:a("bui/select/select"),Combox:a("bui/select/combox"),Suggest:a("bui/select/suggest")}),c}),define("bui/select/select",["bui/common","bui/picker"],function(a){"use strict";function b(a){if($.isPlainObject(a)){var b=[];return c.each(a,function(a,c){b.push({value:c,text:a})}),b}var d=[];return c.each(a,function(a){c.isString(a)?d.push({value:a,text:a}):d.push(a)}),d}var c=a("bui/common"),d=a("bui/picker").ListPicker,e=c.prefix,f=c.Component,g=d,h=e+"select-input",i=f.Controller.extend({initializer:function(){var a,c=this,d=c.get("multipleSelect"),f=c.get("picker");f?c.get("valueField")&&f.set("valueField",c.get("valueField")):(a=d?"listbox":"simple-list",f=new g({children:[{xclass:a,elCls:e+"select-list",store:c.get("store"),items:b(c.get("items"))}],valueField:c.get("valueField")}),c.set("picker",f)),d&&f.set("hideEvent","")},renderUI:function(){var a=this,b=a.get("picker"),c=a.get("el"),d=c.find("."+a.get("inputCls"));b.set("trigger",c),b.set("triggerEvent",a.get("triggerEvent")),b.set("autoSetValue",a.get("autoSetValue")),b.set("textField",d),a.get("forceFit")&&b.set("width",c.outerWidth()),b.render()},bindUI:function(){var a=this,b=a.get("picker"),c=b.get("list");c.get("store"),b.on("selectedchange",function(b){a.fire("change",{text:b.text,value:b.value,item:b.item})}),c.on("itemsshow",function(){a._syncValue()})},containsElement:function(a){var b=this,c=b.get("picker");return f.Controller.prototype.containsElement.call(this,a)||c.containsElement(a)},_uiSetItems:function(a){if(a){var c=this,d=c.get("picker"),e=d.get("list");e.set("items",b(a)),c._syncValue()}},_syncValue:function(){var a=this,b=a.get("picker"),c=a.get("valueField");c&&b.setSelectedValue($(c).val())},_uiSetName:function(a){var b=this,c=b._getTextEl();a&&c.attr("name",a)},_uiSetWidth:function(a){var b=this;if(null!=a){var c=b._getTextEl(),d=b.get("el").find(".x-icon"),e=c.outerWidth()-c.width(),f=b.get("picker"),g=a-d.outerWidth()-e;c.width(g),b.get("forceFit")&&f.set("width",a)}},_getTextEl:function(){var a=this,b=a.get("el");return b.find("."+a.get("inputCls"))},destructor:function(){var a=this,b=a.get("picker");b&&b.destroy()},_getList:function(){var a=this,b=a.get("picker"),c=b.get("list");return c},getSelectedValue:function(){return this.get("picker").getSelectedValue()},setSelectedValue:function(a){var b=this,c=b.get("picker");c.setSelectedValue(a)},getSelectedText:function(){return this.get("picker").getSelectedText()}},{ATTRS:{picker:{},valueField:{},store:{},focusable:{value:!0},multipleSelect:{value:!1},name:{},items:{sync:!1},inputCls:{value:h},forceFit:{value:!0},events:{value:{change:!1}},tpl:{view:!0,value:'<input type="text" readonly="readonly" class="'+h+'"/><span class="x-icon x-icon-normal"><i class="icon icon-caret icon-caret-down"></i></span>'},triggerEvent:{value:"click"}}},{xclass:"select"});return i}),define("bui/select/combox",["bui/common","bui/select/select"],function(a){function b(a,b,c){var d=(c.get("list"),c.getSelectedText());d&&$(a).val(d)}var c=a("bui/common"),d=a("bui/select/select"),e=c.prefix+"combox-input",f=d.extend({renderUI:function(){var a=this,c=a.get("picker");c.set("autoFocused",!1),c.set("getFunction",b)},_uiSetItems:function(a){for(var b=this,d=0;d<a.length;d++){var e=a[d];c.isString(e)&&(a[d]={value:e,text:e})}f.superclass._uiSetItems.call(b,a)}},{ATTRS:{tpl:{view:!0,value:'<input type="text" class="'+e+'"/>'},inputCls:{value:e}}},{xclass:"combox"});return f}),define("bui/select/suggest",["bui/common","bui/select/combox"],function(a){"use strict";var b=a("bui/common"),c=a("bui/select/combox"),d=200,e="",f=c.extend({bindUI:function(){var a=this,b=a.get("el").find("input"),c="keyup"===a.get("triggerEvent")?"keyup":"keyup click";b.on(c,function(){a._start()})},_start:function(){var a=this;a._timer=a.later(function(){a._updateContent()},d)},_updateContent:function(){var a,b=this,c=b.get("data"),d=b.get("el").find("input");if((c||d.val()!==b.get("query"))&&(b.set("query",d.val()),a=d.val(),c||a)){var e=b.get("cacheable"),f=b.get("url"),g=b.get("data");if(e&&f){var h=b.get("dataCache");void 0!==h[a]?b._handleResponse(h[a]):b._requestData()}else f?b._requestData():g&&b._handleResponse(g,!0)}},_getStore:function(){var a=this,b=a.get("picker"),c=b.get("list");return c?c.get("store"):void 0},_requestData:function(){var a=this,b=a.get("el").find("input"),c=a.get("callback"),d=a.get("store"),e={};e[b.attr("name")]=b.val(),d?(e.start=0,d.load(e,c)):$.ajax({url:a.get("url"),type:"post",dataType:a.get("dataType"),data:e,success:function(b){a._handleResponse(b),c&&c(b)}})},_handleResponse:function(a,b){var c=this,d=b?c._getFilterItems(a):a;c.set("items",d),c.get("cacheable")&&(c.get("dataCache")[c.get("query")]=d)},_getItemText:function(a){var b=this,c=b.get("picker"),d=c.get("list");return d?d.getItemText(a):""},_getFilterItems:function(a){function c(a,c){b.isString(c)?e.push(a):e.push(c)}var d=this,e=[],f=d.get("el").find("input"),g=f.val(),h=d.get("data");return a=a||[],b.each(a,function(a){var e=b.isString(a)?a:d._getItemText(a);h?-1!==e.indexOf($.trim(g))&&c(e,a):c(e,a)}),e},later:function(a,b,c){b=b||0;var d=c?setInterval(a,b):setTimeout(a,b);return{id:d,interval:c,cancel:function(){this.interval?clearInterval(d):clearTimeout(d)}}}},{ATTRS:{data:{value:null},query:{value:e},cacheable:{value:!1},dataCache:{value:{}},dataType:{value:"jsonp"},url:{},callback:{},triggerEvent:{valueFn:function(){return this.get("data")?"click":"keyup"}},autoSetValue:{value:!1}}},{xclass:"suggest"});return f});