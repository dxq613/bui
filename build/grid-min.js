/*! BUI - v0.1.0 - 2013-11-18
* https://github.com/dxq613/bui
* Copyright (c) 2013 dxq613; Licensed MIT */
define("bui/grid",["bui/common","bui/grid/simplegrid","bui/grid/grid","bui/grid/column","bui/grid/header","bui/grid/format","bui/grid/plugins"],function(a){var b=a("bui/common"),c=b.namespace("Grid");return b.mix(c,{SimpleGrid:a("bui/grid/simplegrid"),Grid:a("bui/grid/grid"),Column:a("bui/grid/column"),Header:a("bui/grid/header"),Format:a("bui/grid/format"),Plugins:a("bui/grid/plugins")}),c}),define("bui/grid/simplegrid",["bui/common","bui/list"],function(a){var b=a("bui/common"),c=a("bui/list"),d=b.Component,e=(d.UIBase,b.prefix),f=e+"grid",g=f+"-row",h=e+"grid-row-odd",i=e+"grid-row-even",j=e+"grid-border",k=c.SimpleListView.extend({setColumns:function(a){var c=this,d=c.get("headerRowEl");a=a||c.get("columns"),d.empty(),b.each(a,function(a){c._createColumn(a,d)})},_createColumn:function(a,c){var d=this,e=b.substitute(d.get("columnTpl"),a);$(e).appendTo(c)},getItemTpl:function(a,c){var d=this,e=d.get("columns"),f=d.get("rowTpl"),g=0===c%2?h:i,j=[];return b.each(e,function(b){var c=b.dataIndex;j.push(d._getCellTpl(b,c,a))}),f=b.substitute(f,{cellsTpl:j.join(""),oddCls:g})},_getCellTpl:function(a,c,d){var e=this,f=a.renderer,g=f?f(d[c],d):d[c],h=e.get("cellTpl");return b.substitute(h,{elCls:a.elCls,text:g})},clearData:function(){var a=this,b=a.get("itemContainer");b.empty()},showData:function(a){var c=this;b.each(a,function(a,b){c._createRow(a,b)})},_uiSetInnerBorder:function(a){var b=this,c=b.get("el");a?c.addClass(j):c.removeClass(j)},_uiSetTableCls:function(a){var b=this,c=b.get("el").find("table");c.attr("class",a)}},{ATTRS:{headerRowEl:{valueFn:function(){var a=this,b=a.get("el").find("thead");return b.children("tr")}},itemContainer:{valueFn:function(){return this.get("el").find("tbody")}},tableCls:{}}},{xclass:"simple-grid-veiw"}),l=b.List.SimpleList.extend({renderUI:function(){this.get("view").setColumns()},bindUI:function(){var a=this,b=a.get("itemCls"),c=b+"-hover",d=a.get("el");d.delegate("."+b,"mouseover",function(a){var b=$(a.currentTarget);b.addClass(c)}).delegate("."+b,"mouseout",function(a){var b=$(a.currentTarget);b.removeClass(c)})},showData:function(a){this.clearData(),this.set("items",a)},clearData:function(){this.get("view").clearData()},_uiSetColumns:function(a){var b=this;b.clearData(),b.get("view").setColumns(a)}},{ATTRS:{itemCls:{view:!0,value:g},tableCls:{view:!0,value:f+"-table"},columns:{view:!0,sync:!1,value:[]},tpl:{view:!0,value:'<table cellspacing="0" class="{tableCls}" cellpadding="0"><thead><tr></tr></thead><tbody></tbody></table>'},innerBorder:{view:!0,value:!0},rowTpl:{view:!0,value:'<tr class="'+g+' {oddCls}">{cellsTpl}</tr>'},cellTpl:{view:!0,value:'<td class="'+f+'-cell {elCls}"><div class="'+f+'-cell-inner"><span class="'+f+'-cell-text">{text}</span></div></td>'},columnTpl:{view:!0,value:'<th class="'+f+'-hd {elCls}" width="{width}"><div class="'+f+'-hd-inner"><span class="'+f+'-hd-title">{title}</span></div></th>'},events:{value:{}},xview:{value:k}}},{xclass:"simple-grid"});return l.View=k,l}),define("bui/grid/column",["bui/common"],function(a){var b=a("bui/common"),c=b.prefix,d=c+"grid-hd-title",e=c+"grid-hd-open",f="sort-",g="ASC",h="DESC",i=c+"grid-hd-menu-trigger",j="grid-hd-menu-trigger",k=b.Component.View.extend({setTplContent:function(a){var b,c=this,e=c.get("sortTpl"),f=c.get("triggerTpl"),g=c.get("el");k.superclass.setTplContent.call(c,a),b=g.find("."+d),$(e).insertAfter(b),$(f).insertAfter(b)},_setContent:function(){this.setTplContent()},_uiSetShowMenu:function(a){var b=this,c=b.get("triggerTpl"),e=b.get("el"),f=e.find("."+d);a?$(c).insertAfter(f):e.find("."+i).remove()},_uiSetTitle:function(){this.get("rendered")&&this._setContent()},_uiSetDraggable:function(){this.get("rendered")&&this._setContent()},_uiSetSortable:function(){this.get("rendered")&&this._setContent()},_uiSetTpl:function(){this.get("rendered")&&this._setContent()},_uiSetSortState:function(a){var b=this,c=b.get("el"),d=f+"asc",e=f+"desc";c.removeClass(d+" "+e),"ASC"===a?c.addClass(d):"DESC"===a&&c.addClass(e)},_uiSetOpen:function(a){var b=this,c=b.get("el");a?c.addClass(e):c.removeClass(e)}},{ATTRS:{sortTpl:{view:!0,getter:function(){var a=this,b=a.get("sortable");return b?'<span class="'+c+'grid-sort-icon">&nbsp;</span>':""}},tpl:{}}}),l=b.Component.Controller.extend({_toggleSortState:function(){var a=this,b=a.get("sortState"),c=b?b===g?h:g:g;a.set("sortState",c)},performActionInternal:function(a){var b=this,c=$(a.target),d=b.get("prefixCls");c.hasClass(d+j)||b.get("sortable")&&b._toggleSortState()},_uiSetWidth:function(a){a&&this.set("originWidth",a)}},{ATTRS:{elTagName:{value:"th"},open:{view:!0,value:!1},dataIndex:{view:!0,value:""},draggable:{sync:!1,view:!0,value:!0},editor:{},focusable:{value:!1},fixed:{value:!1},id:{},renderer:{},resizable:{value:!0},sortable:{sync:!1,view:!0,value:!0},sortState:{view:!0,value:null},title:{sync:!1,view:!0,value:"&#160;"},width:{value:100},showMenu:{view:!0,value:!1},triggerTpl:{view:!0,value:'<span class="'+i+'"></span>'},tpl:{sync:!1,view:!0,value:'<div class="'+c+'grid-hd-inner">'+'<span class="'+d+'">{title}</span>'+"</div>"},cellTpl:{value:""},events:{value:{afterWidthChange:!0,afterSortStateChange:!0,afterVisibleChange:!0,click:!0,resize:!0,move:!0}},xview:{value:k}}},{xclass:"grid-hd",priority:1});return l.Empty=l.extend({},{ATTRS:{type:{value:"empty"},sortable:{view:!0,value:!1},width:{view:!0,value:null},tpl:{view:!0,value:'<div class="'+c+'grid-hd-inner"></div>'}}},{xclass:"grid-hd-empty",priority:1}),l}),define("bui/grid/header",["bui/common","bui/grid/column"],function(a){var b=a("bui/common"),c=b.prefix,d=(b.namespace("Grid"),a("bui/grid/column")),e=b.Component.View,f=b.Component.Controller,g=17,h=b.UA,i=e.extend({getContentElement:function(){return this.get("el").find("tr")},scrollTo:function(a){var b=this,c=b.get("el");void 0!==a.top&&c.scrollTop(a.top),void 0!==a.left&&c.scrollLeft(a.left)},_uiSetTableCls:function(a){var b=this,c=b.get("el").find("table");c.attr("class",a)}},{ATTRS:{emptyCellEl:{},tableCls:{}}},{xclass:"header-view"}),j=f.extend({addColumn:function(a,b){var c=this,d=0,e=c.get("columns");return a=c._createColumn(a),void 0===b&&(b=e.length,d=c.get("children").length-1),e.splice(b,0,a),c.addChild(a,d),c.fire("add",{column:a,index:b}),a},removeColumn:function(a){var c,d=this,e=d.get("columns");return a=b.isNumber(a)?e[a]:a,c=b.Array.indexOf(a,e),e.splice(c,1),d.fire("remove",{column:a,index:c}),d.removeChild(a,!0)},bindUI:function(){var a=this;a._bindColumnsEvent()},initializer:function(){var a=this,b=a.get("children"),c=a.get("columns"),d=a._createEmptyColumn();$.each(c,function(d,e){var f=a._createColumn(e);b[d]=f,c[d]=f}),b.push(d),a.set("emptyColumn",d)},getColumns:function(){return this.get("columns")},getColumnsWidth:function(){var a=this,b=a.getColumns(),c=0;return $.each(b,function(a,b){b.get("visible")&&(c+=b.get("el").outerWidth())}),c},getColumnOriginWidth:function(){var a=this,b=a.getColumns(),c=0;return $.each(b,function(a,b){if(b.get("visible")){var d=b.get("originWidth")||b.get("width");c+=d}}),c},getColumnByIndex:function(a){var b=this,c=b.getColumns(),d=c[a];return d},getColumn:function(a){var b=this,c=b.getColumns(),d=null;return $.each(c,function(b,c){return a(c)?(d=c,!1):void 0}),d},getColumnById:function(a){var b=this;return b.getColumn(function(b){return b.get("id")===a})},getColumnIndex:function(a){var c=this,d=c.getColumns();return b.Array.indexOf(a,d)},scrollTo:function(a){this.get("view").scrollTo(a)},_bindColumnsEvent:function(){var a=this;a.on("afterWidthChange",function(b){var c=b.target;c!==a&&a.setTableWidth()}),a.on("afterVisibleChange",function(b){var c=b.target;c!==a&&a.setTableWidth()}),a.on("afterSortStateChange",function(b){var c=b.target,d=a.getColumns(),e=b.newVal;e&&$.each(d,function(a,b){b!==c&&b.set("sortState","")})}),a.on("add",function(){a.setTableWidth()}),a.on("remove",function(){a.setTableWidth()})},_createColumn:function(a){return a instanceof d?a:(a.id||(a.id=b.guid("col")),new d(a))},_createEmptyColumn:function(){return new d.Empty},_isAllowScrollLeft:function(){var a=this,b=a.get("parent");return b&&!!b.get("height")},forceFitColumns:function(){function a(a,b){var c=a.get("el");a.set("width",b,{silent:1}),c.width(b)}var b=this,c=b.getColumns(),d=b.get("width"),e=d,f=b.getColumnOriginWidth(),h=0,i=0,j=null,k=b._isAllowScrollLeft();if(d){k&&(d-=g,e=d);var l=0;$.each(c,function(a,b){if(b.get("visible")&&b.get("resizable")&&l++,b.get("visible")&&!b.get("resizable")){var c=b.get("el").outerWidth();e-=c,f-=c}});var m=Math.floor(e/l),n=e/f;if(1===n)return;$.each(c,function(c,d){if(d.get("visible")&&d.get("resizable")){var e=b._getColumnBorderWith(d,c),f=d.get("originWidth");f||(d.set("originWidth",d.get("width")),f=d.get("width")),m=Math.floor((f+e)*n),a(d,m-e),h+=m,j=d}}),j&&(i=e-h,a(j,j.get("width")+i)),b.fire("forceFitWidth")}},_getColumnBorderWith:function(a,b){var c=a.get("el"),d=Math.round(parseFloat(c.css("border-left-width"))||0)+Math.round(parseFloat(c.css("border-right-width"))||0);return d=h.ie&&h.ie<8?0===b?1:d:d},setTableWidth:function(){var a=this,b=a.get("width"),c=0,d=null;"auto"!=b&&(a.get("forceFit")?a.forceFitColumns():a._isAllowScrollLeft()&&(c=a.getColumnsWidth(),d=a.get("emptyColumn"),c>b?d.get("el").width(g):d.get("el").width("auto")))},_uiSetWidth:function(){var a=this;a.setTableWidth()},_uiSetForceFit:function(a){var b=this;a&&b.setTableWidth()}},{ATTRS:{columns:{value:[]},emptyColumn:{},focusable:{value:!1},forceFit:{sync:!1,view:!0,value:!1},tpl:{view:!0,value:'<table cellspacing="0" class="'+c+'grid-table" cellpadding="0">'+"<thead><tr></tr></thead>"+"</table>"},tableCls:{view:!0},xview:{value:i},events:{value:{add:!1,remove:!1}}}},{xclass:"grid-header",priority:1});return j}),define("bui/grid/grid",["bui/common","bui/mask","bui/toolbar","bui/list","bui/grid/header","bui/grid/column"],function(a){function b(a){return d.isString(a)?-1!==a.indexOf("%"):!1}function c(a){return d.isNumber(a)&&(a-=E),a}var d=a("bui/common"),e=(a("bui/mask"),d.UA),f=d.Component,g=(a("bui/toolbar"),a("bui/list")),h=a("bui/grid/header"),i=a("bui/grid/column"),j=d.prefix,k=j+"grid-header-container",l=j+"grid-body",m=j+"grid-width",n=j+"grid-height",o=j+"grid-border",p=j+"grid-tbar",q=j+"grid-bbar",r=j+"grid-button-bar",s=j+"grid-strip",t=j+"grid-row",u=j+"grid-row-odd",v=j+"grid-row-even",w=j+"grid-cell",x=j+"grid-cell-inner",y="grid-td-",z=j+"grid-cell-text",A=j+"grid-cell-empty",B="17",C=j+"hidden",D="data-column-field",E=2,F=g.SimpleListView.extend({renderUI:function(){var a=this,b=a.get("el"),c=b.find("."+l);a.set("bodyEl",c),a._setTableTpl()},getItemTpl:function(a,b){var c=this,e=c._getColumns(),f=(c.get("tbodyEl"),c.get("rowTpl")),g=0===b%2?u:v,h=[];return d.each(e,function(d){var e=d.get("dataIndex");h.push(c._getCellTpl(d,e,a,b))}),c.get("useEmptyCell")&&h.push(c._getEmptyCellTpl()),f=d.substitute(f,{cellsTpl:h.join(""),oddCls:g})},findRow:function(a){var b=this;return $(b.findElement(a))},findCell:function(a,b){var c=y+a;return b.find("."+c)},resetHeaderRow:function(){if(this.get("useHeaderRow")){var a=this,b=a.get("headerRowEl"),c=a.get("tbodyEl");b&&b.remove(),b=a._createHeaderRow(),b.prependTo(c),a.set("headerRowEl",b)}},resetColumnsWidth:function(a,b){var c=this,d=c.get("headerRowEl"),e=c.findCell(a.get("id"),d);b=b||a.get("width"),e&&e.width(b),c.setTableWidth()},setTableWidth:function(a){if(!a&&b(this.get("width")))return this.get("tableEl").width("100%"),void 0;var c=this,d=c._getInnerWidth(),f=c.get("height"),g=c.get("tableEl");if(c.get("forceFit"),c.get("headerRowEl"),!b(a)){if(a=a||c._getColumnsWidth(),!d)return;if(d>=a&&(a=d,f)){var h=6==e.ie||7==e.ie?B+2:B;a=d-h}}g.width(a)},setBodyWidth:function(a){var b=this,c=b.get("bodyEl");a=a||b._getInnerWidth(),c.width(a)},setBodyHeight:function(a){var b=this,c=b.get("bodyEl"),e=a,f=c.siblings();d.each(f,function(a){"none"!==$(a).css("display")&&(e-=$(a).outerHeight())}),c.height(e)},setColumnVisible:function(a){var b=this,c=!a.get("visible"),d=a.get("id"),e=b.get("tbodyEl"),f=$("."+y+d,e);c?f.hide():f.show()},updateItem:function(a){var b=this,c=b.getItems(),e=d.Array.indexOf(a,c),f=b._getColumns(),g=null;return e>=0?(g=b.findElement(a),d.each(f,function(c){var d=b.findCell(c.get("id"),$(g)),f=d.find("."+x),h=b._getCellText(c,a,e);f.html(h)}),g):void 0},showEmptyText:function(){var a=this,b=a.get("bodyEl"),c=a.get("emptyDataTpl"),d=a.get("emptyEl");d&&d.remove();var d=$(c).appendTo(b);a.set("emptyEl",d)},clearEmptyText:function(){var a=this,b=a.get("emptyEl");b&&b.remove()},_createHeaderRow:function(){var a,b=this,c=b._getColumns(),e=b.get("tbodyEl"),f=b.get("headerRowTpl"),g=[];return $.each(c,function(a,c){g.push(b._getHeaderCellTpl(c))}),b.get("useEmptyCell")&&g.push(b._getEmptyCellTpl()),f=d.substitute(f,{cellsTpl:g.join("")}),a=$(f).appendTo(e)},_getColumnsWidth:function(){var a=this,b=a.get("columns"),c=0;return d.each(b,function(a){a.get("visible")&&(c+=a.get("el").outerWidth())}),c},_getColumns:function(){return this.get("columns")},_getCellText:function(a,b,c){var e=this,f=a.get("dataIndex"),g=a.get("cellTpl")||e.get("cellTextTpl"),h=e._getCellInnerText(a,f,b,c);return d.substitute(g,{text:h,tips:e._getTips(a,f,b)})},_getCellInnerText:function(a,b,c,d){try{var e=a.get("renderer"),f=e?e(c[b],c,d):c[b];return null==f?"":f}catch(g){throw"column:"+a.get("title")+" fomat error!"}},_getCellTpl:function(a,b,c,e){var f=this,g=f._getCellText(a,c,e),h=f.get("cellTpl");return d.substitute(h,{elCls:a.get("elCls"),id:a.get("id"),dataIndex:b,cellText:g,hideCls:a.get("visible")?"":C})},_getEmptyCellTpl:function(){return'<td class="'+w+" "+A+'">&nbsp;</td>'},_getHeaderCellTpl:function(a){var b=this,c=b.get("headerCellTpl");return d.substitute(c,{id:a.get("id"),width:a.get("width"),hideCls:a.get("visible")?"":C})},_getInnerWidth:function(){return c(this.get("width"))},_getTips:function(a,b,c){var e=a.get("showTip"),f="";return e&&(f=c[b],d.isFunction(e)&&(f=e(f,c))),f},_uiSetInnerBorder:function(a){var b=this,c=b.get("el");a?c.addClass(o):c.removeClass(o)},_setTableTpl:function(a){var b=this,c=b.get("bodyEl");a=a||b.get("tableTpl"),$(a).appendTo(c);var d=c.find("table"),e=c.find("tbody");b.set("tableEl",d),b.set("tbodyEl",e),b.set("itemContainer",e),b._setTableCls(b.get("tableCls"))},_uiSetTableCls:function(a){this._setTableCls(a)},_uiSetHeight:function(a){var b=this;b.get("bodyEl"),b.get("el").height(a),b.get("el").addClass(n)},_uiSetWidth:function(a){var b=this;b.get("el").width(a),b.setBodyWidth(b._getInnerWidth(a)),b.get("el").addClass(m)},_uiSetStripeRows:function(a){var b=this,c=a?"addClass":"removeClass";b.get("el")[c](s)},_setTableCls:function(a){var b=this,c=b.get("tableEl");c.attr("class",a)}},{ATTRS:{tableCls:{},bodyEl:{},tbodyEl:{},headerRowEl:{},tableEl:{},emptyEl:{}}},{xclass:"grid-view"}),G=g.SimpleList.extend({initializer:function(){var a=this,b=a.get("render"),c=a.get("width");c||a.set("width",$(b).width())},createDom:function(){var a=this;a.get("width")&&a.get("el").addClass(m),a.get("height")&&a.get("el").addClass(n),a.get("innerBorder")&&a.get("el").addClass(o)},renderUI:function(){var a=this;a._initHeader(),a._initBars(),a._initLoadMask(),a.get("view").resetHeaderRow()},bindUI:function(){var a=this;a._bindHeaderEvent(),a._bindBodyEvent(),a._bindItemsEvent()},addColumn:function(a,b){var c=this,d=c.get("header");return d?a=d.addColumn(a,b):(a=new i(a),c.get("columns").splice(b,0,a)),a},clearData:function(){this.clearItems()},getRecords:function(){return this.getItems()},findColumn:function(a){var b=this,c=b.get("header");return d.isNumber(a)?c.getColumnByIndex(a):c.getColumnById(a)},findColumnByField:function(a){var b=this,c=b.get("header");return c.getColumn(function(b){return b.get("dataIndex")===a})},findCell:function(a,b){var c=this,d=null;return d=b instanceof $?b:c.findRow(b),d?c.get("view").findCell(a,d):null},findRow:function(a){var b=this;return b.get("view").findRow(a)},removeColumn:function(a){var b=this;b.get("header").removeColumn(a)},showData:function(a){var b=this;b.set("items",a)},resetColumns:function(){var a=this,b=a.get("store");a.get("view").resetHeaderRow(),b&&a.onLoad()},_bindScrollEvent:function(){var a=this,b=a.get("el"),c=b.find("."+l),d=a.get("header");c.on("scroll",function(){var b=c.scrollLeft(),e=c.scrollTop();d.scrollTo({left:b,top:e}),a.fire("scroll",{scrollLeft:b,scrollTop:e,bodyWidth:c.width(),bodyHeight:c.height()})})},_bindHeaderEvent:function(){var a=this,b=a.get("header"),c=a.get("view"),d=a.get("store");b.on("afterWidthChange",function(a){var d=a.target;d!==b&&c.resetColumnsWidth(d)}),b.on("afterSortStateChange",function(a){var b=a.target,c=a.newVal;c&&d&&d.sort(b.get("dataIndex"),b.get("sortState"))}),b.on("afterVisibleChange",function(d){var e=d.target;e!==b&&(c.setColumnVisible(e),a.fire("columnvisiblechange",{column:e}))}),b.on("click",function(c){var d=c.target;d!==b&&a.fire("columnclick",{column:d,domTarget:c.domTarget})}),b.on("forceFitWidth",function(){a.get("rendered")&&a.resetColumns()}),b.on("add",function(b){a.get("rendered")&&(a.fire("columnadd",{column:b.column,index:b.index}),a.resetColumns())}),b.on("remove",function(b){a.get("rendered")&&(a.resetColumns(),a.fire("columnremoved",{column:b.column,index:b.index}))})},_bindBodyEvent:function(){var a=this;a._bindScrollEvent()},_bindItemsEvent:function(){function a(a){return{record:a.item,row:a.domTarget,domTarget:a.domTarget}}var b=this;b.get("store"),b.on("itemsshow",function(){b.fire("aftershow")}),b.on("itemsclear",function(){b.fire("clear")}),b.on("itemclick",function(a){var c,d=a.domTarget,e=a.item,f=$(d).closest("."+w),g=$(d).closest("."+t);return f.length&&(c=b.fire("cellclick",{record:e,row:g[0],cell:f[0],field:f.attr(D),domTarget:d,domEvent:a.domEvent})),c===!1?c:b.fire("rowclick",{record:e,row:g[0],domTarget:d})}),b.on("itemunselected",function(c){b.fire("rowunselected",a(c))}),b.on("itemselected",function(c){b.fire("rowselected",a(c))}),b.on("itemrendered",function(c){b.fire("rowcreated",a(c))}),b.on("itemremoved",function(c){b.fire("rowremoved",a(c))}),b.on("itemupdated",function(c){b.fire("rowupdated",a(c))})},_getInnerWidth:function(a){return a=a||this.get("width"),c(a)},_initHeader:function(){var a=this,b=a.get("header"),c=a.get("el").find("."+k);b||(b=new h({columns:a.get("columns"),tableCls:a.get("tableCls"),forceFit:a.get("forceFit"),width:a._getInnerWidth(),render:c,parent:a}).render(),a.set("header",b))},_initBars:function(){var a=this,b=a.get("bbar"),c=a.get("tbar");a._initBar(b,q,"bbar"),a._initBar(c,p,"tbar")},_initBar:function(a,b,c){var e=this,g=null,h=null;if(a){if(a.xclass||a instanceof f.Controller||(a.xclass="bar",a.children=a.children||[],a.items&&(a.children.push({xclass:"bar",defaultChildClass:"bar-item-button",elCls:r,children:a.items}),a.items=null),a.pagingBar&&(g=e.get("store"),h={xclass:"pagingbar",store:g,pageSize:g.pageSize},a.pagingBar!==!0&&(h=d.merge(h,a.pagingBar)),a.children.push(h))),a.xclass){var i=e.get("el").find("."+b);i.show(),a.render=i,a.elTagName="div",a.autoRender=!0,a=e.addChild(a)}e.set(c,a)}return a},_initLoadMask:function(){var a=this,b=a.get("loadMask");b&&!b.show&&(b=new d.Mask.LoadMask({el:a.get("el")}),a.set("loadMask",b))},_uiSetWidth:function(a){var c=this;c.get("rendered")&&(b(a)?c.get("header").set("width","100%"):c.get("header").set("width",c._getInnerWidth(a))),c.get("view").setTableWidth()},_uiSetForceFit:function(a){var b=this;b.get("header").set("forceFit",a)},_uiSetHeight:function(a,b){var c=this,d=c.get("header");c.get("view").setBodyHeight(a),c.get("rendered")&&(c.get("forceFit")&&!b.prevVal&&(d.forceFitColumns(),c.get("view").setTableWidth()),d.setTableWidth())},onLoad:function(){var a=this,b=a.get("store");G.superclass.onLoad.call(this),a.get("emptyDataTpl")&&(b&&0==b.getCount()?a.get("view").showEmptyText():a.get("view").clearEmptyText())}},{ATTRS:{header:{},bbar:{},itemCls:{value:t},columns:{view:!0,value:[]},forceFit:{sync:!1,value:!1},emptyDataTpl:{view:!0},headerRowTpl:{view:!0,value:'<tr class="'+j+'grid-header-row">{cellsTpl}</tr>'},headerCellTpl:{view:!0,value:'<td class="{hideCls} '+y+'{id}" width="{width}" style="height:0"></td>'},rowTpl:{view:!0,value:'<tr class="'+t+' {oddCls}">{cellsTpl}</tr>'},cellTpl:{view:!0,value:'<td  class="{elCls} {hideCls} '+w+" "+y+'{id}" data-column-id="{id}" data-column-field = "{dataIndex}" >'+'<div class="'+x+'" >{cellText}</div>'+"</td>"},cellTextTpl:{view:!0,value:'<span class="'+z+' " title = "{tips}">{text}</span>'},events:{value:{aftershow:!1,clear:!1,cellclick:!1,columnclick:!1,rowclick:!1,rowcreated:!1,rowremoved:!1,rowselected:!1,rowunselected:!1,scroll:!1}},stripeRows:{view:!0,value:!0},tbar:{},tableCls:{view:!0,sync:!1,value:j+"grid-table"},tableTpl:{view:!0,value:'<table cellspacing="0" cellpadding="0" ><tbody></tbody></table>'},tpl:{value:'<div class="'+p+'" style="display:none"></div><div class="'+k+'"></div><div class="'+l+'"></div><div style="display:none" class="'+q+'"></div>'},innerBorder:{sync:!1,value:!0},useEmptyCell:{view:!0,value:!0},useHeaderRow:{view:!0,value:!0},xview:{value:F}}},{xclass:"grid"});return G}),define("bui/grid/format",function(){function a(a){return 10>a?"0"+a:a}var b={dateRenderer:function(b){if(!b)return"";if(BUI.isString(b))return b;var c=null;try{c=new Date(b)}catch(d){return""}return c&&c.getFullYear?c.getFullYear()+"-"+a(c.getMonth()+1)+"-"+a(c.getDate()):""},datetimeRenderer:function(b){if(!b)return"";if(BUI.isString(b))return b;var c=null;try{c=new Date(b)}catch(d){return""}return c&&c.getFullYear?c.getFullYear()+"-"+a(c.getMonth()+1)+"-"+a(c.getDate())+" "+a(c.getHours())+":"+a(c.getMinutes())+":"+a(c.getSeconds()):""},cutTextRenderer:function(a){return function(b){return b=b||"",b.toString().length>a?b.toString().substring(0,a)+"...":b}},enumRenderer:function(a){return function(b){return a[b]||""}},multipleItemsRenderer:function(a){var c=b.enumRenderer(a);return function(a){var b=[];return a?(BUI.isArray(a)||(a=a.toString().split(",")),$.each(a,function(a,d){b.push(c(d))}),b.join(",")):""}},moneyCentRenderer:function(a){return BUI.isString(a)&&(a=parseFloat(a)),$.isNumberic(a)?(.01*a).toFixed(2):a}};return b}),function(){var a="bui/grid/plugins/";define("bui/grid/plugins",["bui/common",a+"selection",a+"cascade",a+"cellediting",a+"rowediting",a+"autofit",a+"dialogediting",a+"menu",a+"summary",a+"rownumber"],function(b){var c=b("bui/common"),d=b(a+"selection"),e={};return c.mix(e,{CheckSelection:d.CheckSelection,RadioSelection:d.RadioSelection,Cascade:b(a+"cascade"),CellEditing:b(a+"cellediting"),RowEditing:b(a+"rowediting"),DialogEditing:b(a+"dialogediting"),AutoFit:b(a+"autofit"),GridMenu:b(a+"menu"),Summary:b(a+"summary"),RowNumber:b(a+"rownumber")}),e})}(),define("bui/grid/plugins/menu",["bui/common","bui/menu"],function(a){var b=a("bui/common"),c=a("bui/menu"),d=b.prefix,e="sort-asc",f="sort-desc",g="column-setting",h=function(a){h.superclass.constructor.call(this,a)};return b.extend(h,b.Base),h.ATTRS={menu:{},activedColumn:{},triggerCls:{value:d+"grid-hd-menu-trigger"},items:{value:[{id:e,text:"\u5347\u5e8f",iconCls:"icon-arrow-up"},{id:f,text:"\u964d\u5e8f",iconCls:"icon-arrow-down"},{xclass:"menu-item-sparator"},{id:g,text:"\u8bbe\u7f6e\u5217",iconCls:"icon-list-alt"}]}},b.augment(h,{initializer:function(a){var b=this;b.set("grid",a)},renderUI:function(a){var c=this,d=a.get("columns");b.each(d,function(a){c._addShowMenu(a)})},bindUI:function(a){var b=this;a.on("columnadd",function(a){b._addShowMenu(a.column)}),a.on("columnclick",function(a){var c,d=$(a.domTarget),e=a.column;b.set("activedColumn",e),d.hasClass(b.get("triggerCls"))&&(c=b.get("menu")||b._initMenu(),c.set("align",{node:d,points:["bl","tl"],offset:[0,0]}),c.show(),b._afterShow(e,c))})},_addShowMenu:function(a){a.get("fixed")||a.set("showMenu",!0)},_afterShow:function(a,b){var c=this;c.get("grid"),b=b||c.get("menu"),c._resetSortMenuItems(a,b),c._resetColumnsVisible(b)},_resetColumnsVisible:function(a){var b=this,c=a.findItemById(g),d=c.get("subMenu")||b._initColumnsMenu(c),e=b.get("grid").get("columns");d.removeChildren(!0),$.each(e,function(a,b){if(!b.get("fixed")){var c={xclass:"context-menu-item",text:b.get("title"),column:b,iconCls:"icon"},e=d.addChild(c);b.get("visible")&&e.set("selected",!0)}})},_resetSortMenuItems:function(a,b){var c=b.findItemById(e),d=b.findItemById(f);a.get("sortable")?(c.set("disabled",!1),d.set("disabled",!1)):(c.set("disabled",!0),d.set("disabled",!0))},_initMenu:function(){var a,b=this,d=b.get("menu");return d||(a=b.get("items"),$.each(a,function(a,b){b.xclass||(b.xclass="context-menu-item")}),d=new c.ContextMenu({children:a,elCls:"grid-menu"}),b._initMenuEvent(d),b.set("menu",d)),d},_initMenuEvent:function(a){var b=this;a.on("itemclick",function(a){var c=a.item,d=c.get("id"),g=b.get("activedColumn");d===e?g.set("sortState","ASC"):d===f&&g.set("sortState","DESC")}),a.on("afterVisibleChange",function(a){var c=a.newVal,d=b.get("activedColumn");c&&d?d.set("open",!0):d.set("open",!1)})},_initColumnsMenu:function(a){var b=new c.ContextMenu({multipleSelect:!0,elCls:"grid-column-menu"});return a.set("subMenu",b),b.on("itemclick",function(a){var b=a.item,c=b.get("column"),d=b.get("selected");d?c.set("visible",!0):c.set("visible",!1)}),b},destructor:function(){var a=this,b=a.get("menu");b&&b.destroy(),a.off(),a.clearAttrVals()}}),h}),define("bui/grid/plugins/cascade",["bui/common"],function(a){var b=a("bui/common"),c=b.prefix,d="data-record",e=c+"grid-cascade",f=e+"-expand",g=e+"-row",h=e+"-cell",i=e+"-collapse",j=function(a){j.superclass.constructor.call(this,a)};return b.extend(j,b.Base),j.ATTRS={width:{value:40},cellInner:{value:'<span class="'+e+'"><i class="'+e+'-icon"></i></span>'},rowTpl:{value:'<tr class="'+g+'"><td class="'+h+'"></td></tr>'},renderer:{},events:["expand","collapse","removed"]},b.augment(j,{initializer:function(a){var b=this,c={title:"",elCls:"center",width:b.get("width"),resizable:!1,fixed:!0,sortable:!1,cellTpl:b.get("cellInner")};a.addColumn(c,0),a.set("innerBorder",!1),b.set("grid",a)},bindUI:function(a){var b=this;a.on("cellclick",function(a){var c=$(a.domTarget),d=c.closest("."+e);d.length&&(d.hasClass(f)?b._onCollapse(a.record,a.row,d):b._onExpand(a.record,a.row,d))}),a.on("columnvisiblechange",function(){b._resetColspan()}),a.on("rowremoved",function(a){b.remove(a.record)}),a.on("clear",function(){b.removeAll()})},expandAll:function(){var a=this,b=a.get("grid"),c=b.getRecords();$.each(c,function(b,c){a.expand(c)})},expand:function(a){var b=this,c=b.get("grid"),d=c.findRow(a);d&&b._onExpand(a,d)},collapse:function(a){var b=this,c=b.get("grid"),d=c.findRow(a);d&&b._onCollapse(a,d)},removeAll:function(){var a=this,b=a._getAllCascadeRows();b.each(function(b,c){a._removeCascadeRow(c)})},remove:function(a){var b=this,c=b._findCascadeRow(a);c&&b._removeCascadeRow(c)},collapseAll:function(){var a=this,b=a.get("grid"),c=b.getRecords();$.each(c,function(b,c){a.collapse(c)})},_getRowRecord:function(a){return $(a).data(d)},_removeCascadeRow:function(a){this.fire("removed",{record:$(a).data(d),row:a}),$(a).remove()},_findCascadeRow:function(a){var b=this,c=b._getAllCascadeRows(),d=null;return $.each(c,function(c,e){return b._getRowRecord(e)===a?(d=e,!1):void 0}),d},_getAllCascadeRows:function(){var a=this,b=a.get("grid");return b.get("el").find("."+g)},_getCascadeRow:function(a){var b=$(a).next();return b.hasClass(g)?b:null},_getRowContent:function(a){var b=this,c=b.get("renderer"),d=c?c(a):"";return d},_createCascadeRow:function(a,b){var c=this,e=c.get("rowTpl"),f=c._getRowContent(a),g=$(e).insertAfter(b);return g.find("."+h).append($(f)),g.data(d,a),g},_onExpand:function(a,b,c){var d=this,g=d._getCascadeRow(b);d._getColumnCount(b),c=c||$(b).find("."+e),c.addClass(f),g&&g.length||(g=d._createCascadeRow(a,b)),$(g).removeClass(i),d._setColSpan(g,b),d.fire("expand",{record:a,row:g[0]})},_onCollapse:function(a,b,c){var d=this,g=d._getCascadeRow(b);c=c||$(b).find("."+e),c.removeClass(f),(g||!g.length)&&($(g).addClass(i),d.fire("collapse",{record:a,row:g[0]}))},_getColumnCount:function(a){return $(a).children().filter(function(){return"none"!==$(this).css("display")}).length},_setColSpan:function(a,b){b=b||$(a).prev();var c=this,d=c._getColumnCount(b);$(a).find("."+h).attr("colspan",d)},_resetColspan:function(){var a=this,b=a._getAllCascadeRows();$.each(b,function(b,c){a._setColSpan(c)})},destructor:function(){var a=this;a.removeAll(),a.off(),a.clearAttrVals()}}),j}),define("bui/grid/plugins/selection",["bui/common"],function(a){function b(a){b.superclass.constructor.call(this,a)}var c=a("bui/common"),d=c.prefix,e=d+"grid-checkBox",f="x-grid-checkbox",g=d+"grid-radio";c.extend(b,c.Base),b.ATTRS={width:{value:40},column:{},cellInner:{value:'<div class="'+e+'-container"><span class="'+f+'"></span></div>'}},c.augment(b,{createDom:function(a){var b=this,c={title:"",width:b.get("width"),fixed:!0,resizable:!1,sortable:!1,tpl:'<div class="'+d+'grid-hd-inner">'+b.get("cellInner"),cellTpl:b.get("cellInner")},e=a.addColumn(c,0);a.set("multipleSelect",!0),b.set("column",e)},bindUI:function(a){var b=this,c=b.get("column"),d=c.get("el"),e=d.find("."+f);e.on("click",function(){var b=d.hasClass("checked");b?(a.clearSelection(),d.removeClass("checked")):(a.setAllSelection(),d.addClass("checked"))}),a.on("rowunselected",function(){d.removeClass("checked")}),a.on("clear",function(){d.removeClass("checked")})}});var h=function(a){h.superclass.constructor.call(this,a)};c.extend(h,c.Base),h.ATTRS={width:{value:40},column:{},cellInner:{value:'<div class="'+d+'grid-radio-container"><input  class="'+g+'" type="radio"></div>'}},c.augment(h,{createDom:function(a){var b=this,c={title:"",width:b.get("width"),resizable:!1,fixed:!0,sortable:!1,cellTpl:b.get("cellInner")},d=a.addColumn(c,0);a.set("multipleSelect",!1),b.set("column",d)},bindUI:function(a){var b=this;a.on("rowselected",function(a){b._setRowChecked(a.row,!0)}),a.on("rowunselected",function(a){b._setRowChecked(a.row,!1)})},_setRowChecked:function(a,b){var c=$(a),d=c.find("."+g);d.attr("checked",b)}});var i={CheckSelection:b,RadioSelection:h};return i}),define("bui/grid/plugins/summary",["bui/common"],function(a){function b(a){return a>0?'<td class="'+n+'" colspan="'+a+'">&nbsp;</td>':""}function c(a,b){return'<td class="'+n+" "+l+b+'">'+d(a)+"</td>"}function d(a){return'<div class="'+k+'" >'+'<span class="'+m+' ">'+a+"</span>"+"</div>"}function e(){return'<td class="'+n+" "+n+'-empty">&nbsp;</td>'}var f=a("bui/common"),g=f.prefix,h=g+"grid-row",i=g+"grid-body",j=g+"grid-summary-row",k=g+"grid-cell-inner",l="grid-td-",m=g+"grid-cell-text",n=g+"grid-cell",o=function(a){o.superclass.constructor.call(this,a)};return o.ATTRS={footerTpl:{value:"<tfoot></tfoot>"},footerEl:{},summaryTitle:{value:"\u67e5\u8be2\u5408\u8ba1"},pageSummaryTitle:{value:"\u672c\u9875\u5408\u8ba1"},field:{value:"summary"},pageSummaryField:{value:"pageSummary"},summaryField:{value:"summary"},pageSummary:{},summary:{}},f.extend(o,f.Base),f.augment(o,{initializer:function(a){var b=this;b.set("grid",a)},renderUI:function(a){var b=this,c=a.get("el").find("."+i),d=c.find("table"),e=$(b.get("footerTpl")).appendTo(d);b.set("footerEl",e)},bindUI:function(a){var b=this,c=a.get("store");c&&(c.on("beforeprocessload",function(a){b._processSummary(a.data)}),c.on("add",function(){b.resetPageSummary()}),c.on("remove",function(){b.resetPageSummary()}),c.on("update",function(){b.resetPageSummary()})),a.on("aftershow",function(){b.resetSummary()}),a.get("header").on("afterVisibleChange",function(){b.resetSummary()})},_processSummary:function(a){var b=this,c=b.get("footerEl");if(c.empty(),a){var d=a[b.get("pageSummaryField")],e=a[b.get("summaryField")];b.set("pageSummary",d),b.set("summary",e)}},resetPageSummary:function(){var a=this,b=a.get("grid"),c=b.get("columns"),d=a._calculatePageSummary(),e=a.get("pageEl");a.set("pageSummary",d),e&&(f.each(c,function(b){if(b.get("summary")&&b.get("visible")){var c=b.get("id"),f=e.find("."+l+c),g=a._getSummaryCellText(b,d);f.find("."+m).text(g)}}),a._updateFirstRow(e,a.get("pageSummaryTitle")))},resetSummary:function(a,b){var c=this,d=c.get("footerEl"),e=null;d.empty(),a=a||c.get("pageSummary"),a||(a=c._calculatePageSummary(),c.set("pageSummary",a)),b=b||c.get("summary"),e=c._creatSummaryRow(a,c.get("pageSummaryTitle")),c.set("pageEl",e),c._creatSummaryRow(b,c.get("summaryTitle"))
},_creatSummaryRow:function(a,b){if(!a)return null;var c=this,d=c.get("footerEl"),e=c._getSummaryTpl(a),f=$(e).appendTo(d);return c._updateFirstRow(f,b),f},_updateFirstRow:function(a,b){var c=a.find("td").first(),e=c.find("."+k);if(e.length){var f=b+": ";text=e.text(),-1===text.indexOf(f)&&(text=f+text),c.html(d(text))}else c.html(d(b+":"))},_getSummaryTpl:function(a){var d=this,f=d.get("grid"),g=f.get("columns"),i=[],k=-1,l=-1,m=null;return $.each(g,function(e,f){if(f.get("visible")&&(l+=1,f.get("summary"))){i.push(b(l-k-1));var g=d._getSummaryCellText(f,a),h=c(g,f.get("id"));i.push(h),k=l}}),k!==l&&i.push(b(l-k)),m=['<tr class="',j," ",h,'">',i.join(""),e(),"</tr>"].join("")},_getSummaryCellText:function(a,b){var c=b[a.get("dataIndex")],d=null==c?"":c,e=a.get("renderer"),f=e?e(d,b):d;return f},_calculatePageSummary:function(){var a=this,b=a.get("grid"),c=b.get("store"),d=b.get("columns"),e={};return f.each(d,function(a){if(a.get("summary")){var b=a.get("dataIndex");e[b]=c.sum(b)}}),e}}),o}),define("bui/grid/plugins/editing",function(){function a(b){a.superclass.constructor.call(this,b)}var b=BUI.prefix+"grid-cell-inner",c=BUI.prefix+"grid-cell-error";return BUI.extend(a,BUI.Base),a.ATTRS={align:{value:{points:["cl","cl"]}},showError:{value:!0},errorTpl:{value:'<span class="x-icon '+c+' x-icon-mini x-icon-error" title="{error}">!</span>'},isInitEditors:{value:!1},record:{},curEditor:{},hasValid:{},editors:{value:[]},triggerCls:{},triggerSelected:{value:!0}},BUI.augment(a,{initializer:function(a){var b=this;b.set("grid",a),b.initEditing(a)},renderUI:function(){var a=this,b=a.get("grid");BUI.use("bui/editor",function(c){a.initEditors(c),a._initGridEvent(b),a.set("isInitEditors",!0)})},initEditing:function(){},_getCurEditor:function(){return this.get("curEditor")},_initGridEvent:function(a){function b(a,b){c.get("hasValid")&&c.validRecord(a,c.getFields(),$(b))}var c=this,d=a.get("header");a.on("cellclick",function(a){var b=null,d=a.domTarget,e=c.get("triggerCls"),f=c._getCurEditor();return f&&f.get("acceptEvent")?(f.accept(),f.hide()):f&&f.cancel(),b=c.getEditor(a.field),b&&$(d).closest("."+e).length&&(c.showEditor(b,a),!c.get("triggerSelected"))?!1:void 0}),a.on("rowcreated",function(a){b(a.record,a.row)}),a.on("rowremoved",function(a){c.get("record")==a.record&&c.cancel()}),a.on("rowupdated",function(a){b(a.record,a.row)}),a.on("scroll",function(a){var b=c._getCurEditor();if(b){var d=b.get("align"),e=d.node,f=e.position();f.top<0||f.top>a.bodyHeight?b.hide():(b.set("align",d),b.show())}}),d.on("afterVisibleChange",function(a){if(a.target&&a.target!=d){var b=a.target;c.onColumnVisibleChange(b)}})},initEditors:function(a){var b=this,c=b.get("grid"),d=[],e=c.get("columns");BUI.each(e,function(a){var c=b.getFieldConfig(a);c&&(c.name=a.get("dataIndex"),c.id=a.get("id"),c.validator&&(c.validator=b.wrapValidator(c.validator)),d.push(c))});var f=b.getEditorCfgs(d);BUI.each(f,function(c){b.initEidtor(c,a)})},getFieldConfig:function(a){return a.get("editor")},wrapValidator:function(a){var b=this;return function(c){var d=b.get("record");return a(c,d)}},onColumnVisibleChange:function(){},getEditorCfgs:function(){},getEditorConstructor:function(a){return a.Editor},initEidtor:function(a,b){var c=this,d=c.getEditorConstructor(b),e=new d(a);return e.render(),c.get("editors").push(e),c.bindEidtor(e),e},bindEidtor:function(a){var b=this,c=b.get("grid"),d=c.get("store");a.on("accept",function(){var c=b.get("record");b.updateRecord(d,c,a),b.set("curEditor",null)}),a.on("cancel",function(){b.set("curEditor",null)})},getEditor:function(){},getAlignNode:function(){},getEditValue:function(){},showEditor:function(a,b){var c=this,d=c.getEditValue(b),e=c.getAlignNode(b);if(c.beforeShowEditor(a,b),c.set("record",b.record),a.setValue(d),e){var f=c.get("align");f.node=e,a.set("align",f)}a.show(),c.focusEditor(a,b.field),c.set("curEditor",a)},focusEditor:function(a){a.focus()},beforeShowEditor:function(){},_createEditOptions:function(a,b){var c=this,d=c.get("grid"),e=d.findRow(a),f=d.findColumnByField(b),g=d.findCell(f.get("id"),e);return{record:a,field:b,cell:g[0],row:e[0]}},valid:function(){var a=this,b=a.get("grid"),c=b.get("store");if(c){var d=c.getResult();BUI.each(d,function(b){a.validRecord(b,a.getFields())})}a.set("hasValid",!0)},isValid:function(){var a=this,b=a.get("grid");return a.get("hasValid")||a.valid(),!b.get("el").find("."+c).length},clearErrors:function(){var a=this,b=a.get("grid");b.get("el").find("."+c).remove()},getFields:function(){},validRecord:function(a,b,c){var d=this,e=[];d.setInternal("record",a),b=b||d.getFields(),BUI.each(b,function(b){var c=b.get("name"),d=a[c]||"",f=b.getValidError(d);f&&e.push({name:c,error:f,id:b.get("id")})}),d.showRecordError(a,e,c)},showRecordError:function(a,b,c){var d=this,e=d.get("grid");c=c||e.findRow(a),c&&(d._clearRowError(c),BUI.each(b,function(a){var b=e.findCell(a.id,c);d._showCellError(b,a.error)}))},updateRecord:function(){},_clearRowError:function(a){a.find("."+c).remove()},_showCellError:function(a,c){var d=this,e=BUI.substitute(d.get("errorTpl"),{error:c}),f=a.find("."+b);$(e).appendTo(f)},edit:function(a,b){var c=this,d=c._createEditOptions(a,b),e=c.getEditor(b);c.showEditor(e,d)},cancel:function(){var a=this,b=a.get("editors");BUI.each(b,function(a){a.get("visible")&&a.cancel()}),a.set("curEditor",null),a.set("record",null)},destructor:function(){var a=this,b=a.get("editors");BUI.each(b,function(a){a.destroy||a.destroy()}),a.off(),a.clearAttrVals()}}),a}),define("bui/grid/plugins/cellediting",["bui/grid/plugins/editing"],function(a){var b=a("bui/grid/plugins/editing"),c=BUI.prefix+"grid-body",d=BUI.prefix+"grid-cell",e=function(a){e.superclass.constructor.call(this,a)};return e.ATTRS={triggerCls:{value:d}},BUI.extend(e,b),BUI.augment(e,{getEditorCfgs:function(a){var b=this,d=b.get("grid"),e=d.get("el").find("."+c),f=[];return BUI.each(a,function(a){var b={field:a,changeSourceEvent:null,hideExceptNode:e,autoUpdate:!1,preventHide:!1,editableFn:a.editableFn};"checkbox"===a.xtype&&(b.innerValueField="checked"),f.push(b)}),f},getEditor:function(a){if(!a)return null;var b=this,c=b.get("editors"),d=null;return BUI.each(c,function(b){return b.get("field").get("name")===a?(d=b,!1):void 0}),d},beforeShowEditor:function(a,b){var c=this,d=$(b.cell);c.resetWidth(a,d.outerWidth()),c._makeEnable(a,b)},_makeEnable:function(a,b){var c,d,e,f=a.get("editableFn");BUI.isFunction(f)&&(c=b.field,e=b.record,e&&c&&(d=f(e[c],e),d?a.get("field").enable():a.get("field").disable()))},resetWidth:function(a,b){a.set("width",b)},updateRecord:function(a,b,c){var d=c.getValue(),e=c.get("field").get("name"),f=b[e];d=BUI.isDate(d)?d.getTime():d,f!==d&&a.setValue(b,e,d)},getAlignNode:function(a){return $(a.cell)},getFields:function(){var a=[],b=this,c=b.get("editors");return BUI.each(c,function(b){a.push(b.get("field"))}),a},getEditValue:function(a){if(a.record&&a.field){var b=a.record[a.field];return null==b?"":b}return""}}),e}),define("bui/grid/plugins/rowediting",["bui/common","bui/grid/plugins/editing"],function(a){var b=a("bui/common"),c=a("bui/grid/plugins/editing"),d=b.prefix+"grid-row",e=function(a){e.superclass.constructor.call(this,a)};return e.ATTRS={align:{value:{points:["tl","tl"],offset:[-2,0]}},triggerCls:{value:d}},b.extend(e,c),b.augment(e,{getEditorCfgs:function(a){var b=[];return b.push({changeSourceEvent:null,autoUpdate:!1,form:{children:a,buttonBar:{elCls:"centered toolbar"}}}),b},wrapValidator:function(a){var b=this;return function(c){var d=b.get("curEditor"),e=d?d.getValue():b.get("record");return e?a(c,e):void 0}},focusEditor:function(a,b){var c=a.get("form"),d=c.getField(b);d&&d.focus()},getFieldConfig:function(a){var b=a.get("editor");if(b)return"checkbox"===b.xtype&&(b.innerValueField="checked"),b;var c={xtype:"plain"};return a.get("dataIndex")&&a.get("renderer")&&(c.renderer=a.get("renderer")),c},updateRecord:function(a,c,d){var e=d.getValue();b.each(e,function(a,c){b.isDate(a)&&(e[c]=a.getTime())}),b.mix(c,e),a.update(c)},getEditor:function(){var a=this,b=a.get("editors");return b[0]},onColumnVisibleChange:function(a){var b=this,c=a.get("id"),d=b.getEditor(),e=d.getChild(c,!0);e&&e.set("visible",a.get("visible"))},beforeShowEditor:function(a,c){var d=this,e=d.get("grid"),f=e.get("columns"),g=a.get("form"),h=$(c.row);a.set("width",h.width()),b.each(f,function(a){if(a.get("visible")){var b=a.get("dataIndex"),c=g.getField(b),d=a.get("el").outerWidth()-c.getAppendWidth();c.set("width",d)}else c.set("visible",!1)})},getEditValue:function(a){return a.record},getEditorConstructor:function(a){return a.RecordEditor},getAlignNode:function(a){return $(a.row)},getFields:function(){var a=this,b=a.get("editors");return b[0].get("form").get("children")}}),e}),define("bui/grid/plugins/dialogediting",["bui/common"],function(a){function b(a){b.superclass.constructor.call(this,a)}var c=a("bui/common"),d="add",e="edit";return b.ATTRS={record:{},curIndex:{},contentId:{},editor:{},form:{},events:{value:{recordchange:!1}},editType:{}},c.extend(b,c.Base),c.augment(b,{initializer:function(a){var b=this;b.set("grid",a),c.use("bui/editor",function(a){b._initEditor(a)})},bindUI:function(a){var b=this,c=b.get("triggerCls");c&&a.on("cellclick",function(d){var e=$(d.domTarget),f=b.get("editor");return e.hasClass(c)&&f&&(b.edit(d.record),a.get("multipleSelect"))?!1:void 0})},_initEditor:function(a){var b=this,d=b.get("contentId"),e=$("#"+d).find("form"),f=b.get("editor"),g=c.merge(f,{contentId:d,form:{srcNode:e}});f=new a.DialogEditor(g),b._bindEditor(f),b.set("editor",f),b.set("form",f.get("form"))},_bindEditor:function(a){var b=this;a.on("accept",function(){var c=a.get("form"),d=c.serializeToObject();b.saveRecord(d)})},edit:function(a){var b=this;b.set("editType",e),b.showEditor(a)},add:function(a,b){var c=this;c.set("editType",d),c.set("curIndex",b),c.showEditor(a)},saveRecord:function(a){var b=this,e=b.get("grid"),f=b.get("editType"),g=b.get("curIndex"),h=e.get("store"),i=b.get("record");c.mix(i,a),f==d?null!=g?h.addAt(i,g):h.add(i):h.update(i)},showEditor:function(a){var b=this,c=b.get("editor");c.show(),c.setValue(a,!0),b.set("record",a),b.fire("recordchange",{record:a,editType:b.get("editType")})},cancel:function(){var a=this,b=a.get("editor");b.cancel()},destructor:function(){var a=this,b=a.get("editor");b&&b.destroy(),a.off(),a.clearAttrVals()}}),b});