/*! BUI - v0.1.0 - 2013-11-18
* https://github.com/dxq613/bui
* Copyright (c) 2013 dxq613; Licensed MIT */
define("bui/slider",["bui/slider/slider"],function(a){var b=BUI.namespace("Slider");return BUI.mix(b,{Slider:a("bui/slider/slider")}),b}),define("bui/slider/slider",["bui/common"],function(a){"use strict";function b(a,b){return a>b&&(a=b),0>a&&(a=0),100*(a/b)}var c=document,d=a("bui/common"),e="x-slider-handle",f="x-slider-vertical",g="x-slider-horizontal",h="x-slider-back",i=e+"-start",j=e+"-end",k=d.Component.View.extend({renderUI:function(){var a=this,b=a.get("isVertical");b?a.get("el").addClass(f):a.get("el").addClass(g)},setRange:function(a,b,c){function d(a){return a+"%"}a>b&&(a=b);var e=this,f=e.get("backEl"),g=e.get("isVertical"),h=e.get("handleEl"),i=h.length,j=b-a,k=c?e.get("duration"):null,l=g?"height":"width",m=g?"bottom":"left",n=c?"animate":"css",o={},p={};f&&(o[l]=j+"%",o[m]=a+"%",f[n](o,k)),1===i?(p[m]=d(b),h[n](p,k)):2===i&&(p[m]=d(a),h[0].style[m]!==p[m]&&$(h[0])[n](p,k),p[m]=d(b),h[1].style[m]!==p[m]&&$(h[1])[n](p,k))},_uiSetBackTpl:function(a){var b=this,c=b.get("el"),d=$(a).appendTo(c);d.addClass(h),b.setInternal("backEl",d)},_uiSetHandleTpl:function(a){var b,c=this,d=c.get("el"),f=c.get("range");f?(c._createHandleEl(a,i),c._createHandleEl(a,j)):c._createHandleEl(a),b=d.find("."+e),c.setInternal("handleEl",b)},_createHandleEl:function(a,b){var c=this,d=c.get("el"),f=$(a).appendTo(d);f.addClass(e),f.attr("tabindex","0"),b&&f.addClass(b)}},{ATTRS:{backEl:{},handleEl:{}}}),l=d.Component.Controller.extend({slideTo:function(a){this.set("value",a)},bindUI:function(){var a=this,b=a.get("el");b.find(".x-slider-handle").on("click",function(a){a.preventDefault()}),b.on("mousedown",function(c){var d=$(c.target),e=b.offset();d.hasClass("x-slider-handle")?(c.preventDefault(),a._handleDrag(c)):(e={left:c.pageX-e.left,top:c.pageY-e.top},a._slideByOffset(e,!0))})},_slideByOffset:function(a,b){var c=this,e=c.get("value"),f=c._formatValue(a);e===f||d.isArray(f)&&d.Array.equals(f,e)||(b?c.set("value",f):(c.setInternal("value",f),c._setValue(f,!1)))},_handleDrag:function(a){function b(a){var b=g.get("draging");if(b){a.preventDefault();var c=a.pageX,d=a.pageY,e={};e.left=b.elX+(c-b.startX),e.top=b.elY+(d-b.startY),g._slideByOffset(e,!1)}}function d(){$(c).on("mousemove",b),$(c).on("mouseup",f)}function e(){$(c).off("mousemove",b),$(c).off("mouseup",f)}function f(a){1==a.which&&(g.set("draging",!1),e())}var g=this,h=g.get("isVertical"),i=$(a.target),j=i.position();1==a.which&&(g.set("draging",{elX:j.left,elY:h?j.top+i.height():j.top,startX:a.pageX,startY:a.pageY}),d())},_getCalcValue:function(a){var c,d,e=this,f=e.get("el"),g=e.get("max"),h=e.get("min"),i=e.get("step"),j=e.get("isVertical"),k=j?f.height():f.width();if(c=j?b(f.height()-a.top,k):b(a.left,k),d=(g-h)*c/100+h,i){d=parseInt(d,10);var l=d%i;l&&(d+=i-l)}return d},_formatValue:function(a){var b=this,c=b.get("value"),e=b._getCalcValue(a);if(d.isNumber(c))return e;if(d.isArray(c)){var f=Math.abs(c[0]-e),g=Math.abs(c[1]-e);return g>f?[e,c[1]]:[c[0],e]}return c},_uiSetValue:function(a){this._setValue(a,!0)},_setValue:function(a,c){var e,f,g=this,h=g.get("min"),i=g.get("max"),j=i-h;d.isNumber(a)?(e=0,f=b(a-h,j)):d.isArray(a)&&(e=b(a[0]-h,j),f=b(a[1]-h,j)),g._setRange(e,f,c),g.fire("change",{value:a})},_setRange:function(a,b,c){this.get("view").setRange(a,b,c)}},{ATTRS:{min:{value:0},duration:{view:!0,value:400},max:{value:100},value:{view:!0},step:{value:1},handleTpl:{view:!0,value:"<span></span>"},isVertical:{view:!0,value:!1},range:{view:!0,value:!1},backTpl:{view:!0,value:"<div></div>"},xview:{value:k}}},{xclass:"slider"});return l});