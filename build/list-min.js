/*! BUI - v0.1.0 - 2013-11-18
* https://github.com/dxq613/bui
* Copyright (c) 2013 dxq613; Licensed MIT */
!function(){var a="bui/list/";define("bui/list",["bui/common",a+"list",a+"listitem",a+"simplelist",a+"listbox"],function(b){var c=b("bui/common"),d=c.namespace("List");return c.mix(d,{List:b(a+"list"),ListItem:b(a+"listitem"),SimpleList:b(a+"simplelist"),Listbox:b(a+"listbox")}),c.mix(d,{ListItemView:d.ListItem.View,SimpleListView:d.SimpleList.View}),d})}(),define("bui/list/domlist",["bui/common"],function(a){"use strict";function b(a,b){var c=b,d=c.get("itemCls"),e=c.get("itemStatusCls");return e&&e[a]?e[a]:d+"-"+a}function c(a,c){var e=a.attributes,g=c.get("itemStatusFields"),h={};return d.each(e,function(a){var b=a.nodeName;-1!==b.indexOf(f)&&(b=b.replace(f,""),h[b]=a.nodeValue)}),h.text=$(a).text(),d.each(g,function(d,e){var f=b(e,c);$(a).hasClass(f)&&(h[d]=!0)}),h}var d=a("bui/common"),e=d.Component.UIBase.Selection,f="data-",g=d.Component.UIBase.List,h=function(){};h.ATTRS={items:{}},h.prototype={clearControl:function(){var a=this,b=a.getItemContainer(),c=a.get("itemCls");b.find("."+c).remove()},addItem:function(a,b){return this._createItem(a,b)},getItems:function(){var a=this,b=a.getAllElements(),c=[];return d.each(b,function(b){c.push(a.getItemByElement(b))}),c},updateItem:function(a){var b,c=this,e=c.getItems(),f=d.Array.indexOf(a,e),g=null;return f>=0&&(g=c.findElement(a),b=c.getItemTpl(a,f),g&&$(g).html($(b).html())),g},removeItem:function(a,b){b=b||this.findElement(a),$(b).remove()},getItemContainer:function(){var a=this.get("itemContainer");return a.length?a:this.get("el")},getItemTpl:function(a,b){var c=this,e=c.get("itemTplRender"),f=c.get("itemTpl");return e?e(a,b):d.substitute(f,a)},_createItem:function(a,b){var c=this,d=c.getItemContainer(),e=c.get("itemCls"),f=c.get("dataField"),g=c.getItemTpl(a,b),h=$(g);if(void 0!==b){var i=d.find("."+e)[b];i?h.insertBefore(i):h.appendTo(d)}else h.appendTo(d);return h.addClass(e),h.data(f,a),h},getItemStatusCls:function(a){return b(a,this)},setItemStatusCls:function(a,b,c){var d=this,e=d.getItemStatusCls(a),f=c?"addClass":"removeClass";b&&$(b)[f](e)},hasStatus:function(a,b){var c=this,d=c.getItemStatusCls(a);return $(b).hasClass(d)},setItemSelected:function(a,b,c){var d=this;c=c||d.findElement(a),d.setItemStatusCls("selected",c,b)},getAllElements:function(){var a=this,b=a.get("itemCls"),c=a.get("el");return c.find("."+b)},getItemByElement:function(a){var b=this,c=b.get("dataField");return $(a).data(c)},getFirstElementByStatus:function(a){var b=this,c=b.getItemStatusCls(a),d=b.get("el");return d.find("."+c)[0]},getElementsByStatus:function(a){var b=this,c=b.getItemStatusCls(a),d=b.get("el");return d.find("."+c)},getSelectedElements:function(){var a=this,b=a.getItemStatusCls("selected"),c=a.get("el");return c.find("."+b)},findElement:function(a){var b=this,c=b.getAllElements(),e=null;return d.each(c,function(c){return b.getItemByElement(c)==a?(e=c,!1):void 0}),e},isElementSelected:function(a){var b=this,c=b.getItemStatusCls("selected");return a&&$(a).hasClass(c)}};var i=function(){};return i.ATTRS=d.merge(!0,g.ATTRS,e.ATTRS,{dataField:{view:!0,value:"data-item"},itemContainer:{view:!0},itemStatusFields:{value:{}},itemCls:{view:!0},textGetter:{},defaultLoaderCfg:{value:{property:"items",dataType:"json"}},events:{value:{itemrendered:!0,itemremoved:!0,itemupdated:!0,itemsshow:!1,beforeitemsshow:!1,itemsclear:!1,itemdblclick:!1,beforeitemsclear:!1}}}),i.PARSER={items:function(a){var b=this,e=[],f=b.get("itemCls"),g=b.get("dataField"),h=a.find("."+f);return h.length||(h=a.children(),h.addClass(f)),d.each(h,function(a){var d=c(a,b);e.push(d),$(a).data(g,d)}),e}},d.augment(i,g,e,{_uiSetItems:function(a){var b=this;(!b.get("srcNode")||b.get("rendered"))&&this.setItems(a)},__bindUI:function(){function a(a,c){var d,e=b.get("multipleSelect");d=b.isItemSelected(a,c),d?e&&b.setItemSelected(a,!1,c):(e||b.clearSelected(),b.setItemSelected(a,!0,c))}var b=this,c=b.get("selectedEvent"),d=b.get("itemCls"),e=b.get("view").getItemContainer();e.delegate("."+d,"click",function(d){if(!b.get("disabled")){var e=$(d.currentTarget),f=b.getItemByElement(e);if(!b.isItemDisabled(f,e)){var g=b.fire("itemclick",{item:f,element:e[0],domTarget:d.target});g!==!1&&"click"==c&&b.isItemSelectable(f)&&a(f,e)}}}),"click"!==c&&e.delegate("."+d,c,function(c){if(!b.get("disabled")){var d=$(c.currentTarget),e=b.getItemByElement(d);b.isItemDisabled(e,d)||b.isItemSelectable(e)&&a(e,d)}}),e.delegate("."+d,"dblclick",function(a){if(!b.get("disabled")){var c=$(a.currentTarget),d=b.getItemByElement(c);b.isItemDisabled(d,c)||b.fire("itemdblclick",{item:d,element:c[0],domTarget:a.target})}}),b.on("itemrendered itemupdated",function(a){var c=a.item,d=a.element;b._syncItemStatus(c,d)})},getValueByField:function(a,b){return a&&a[b]},_syncItemStatus:function(a,b){var c=this,e=c.get("itemStatusFields");d.each(e,function(d,e){null!=a[d]&&c.get("view").setItemStatusCls(e,b,a[d])})},getStatusValue:function(a,b){var c=this,d=c.get("itemStatusFields"),e=d[b];return a[e]},getCount:function(){var a=this.getItems();return a?a.length:0},getStatusField:function(a){var b=this,c=b.get("itemStatusFields");return c[a]},setStatusValue:function(a,b,c){var d=this,e=d.get("itemStatusFields"),f=e[b];f&&(a[f]=c)},getItemText:function(a){var b=this,c=b.get("textGetter");return a?c?c(a):$(b.findElement(a)).text():""},removeItem:function(a){var b,c=this,e=c.get("items"),f=c.findElement(a);b=d.Array.indexOf(a,e),-1!==b&&e.splice(b,1),c.get("view").removeItem(a,f),c.fire("itemremoved",{item:a,domTarget:$(f)[0],element:f})},addItemAt:function(a,b){var c=this,d=c.get("items");return void 0===b&&(b=d.length),d.splice(b,0,a),c.addItemToView(a,b),a},addItemToView:function(a,b){var c=this,d=c.get("view").addItem(a,b);return c.fire("itemrendered",{item:a,domTarget:$(d)[0],element:d}),d},updateItem:function(a){var b=this,c=b.get("view").updateItem(a);b.fire("itemupdated",{item:a,domTarget:$(c)[0],element:c})},setItems:function(a){var b=this;a!=b.getItems()&&b.setInternal("items",a),b.clearControl(),b.fire("beforeitemsshow"),d.each(a,function(a,c){b.addItemToView(a,c)}),b.fire("itemsshow")},getItems:function(){return this.get("items")},getItemByElement:function(a){return this.get("view").getItemByElement(a)},getSelected:function(){var a=this,b=a.get("view").getFirstElementByStatus("selected");return a.getItemByElement(b)||null},getItemsByStatus:function(a){var b=this,c=b.get("view").getElementsByStatus(a),e=[];return d.each(c,function(a){e.push(b.getItemByElement(a))}),e},findElement:function(a){var b=this;return d.isString(a)&&(a=b.getItem(a)),this.get("view").findElement(a)},findItemByField:function(a,b){var c=this,e=c.get("items"),f=null;return d.each(e,function(c){return c[a]===b?(f=c,!1):void 0}),f},setItemSelectedStatus:function(a,b,c){var d=this;c=c||d.findElement(a),d.setItemStatus(a,"selected",b,c)},setAllSelection:function(){var a=this,b=a.getItems();a.setSelection(b)},isItemSelected:function(a,b){var c=this;return b=b||c.findElement(a),c.get("view").isElementSelected(b)},isItemDisabled:function(a,b){return this.hasStatus(a,"disabled",b)},setItemDisabled:function(a,b){var c=this;c.setItemStatus(a,"disabled",b)},getSelection:function(){var a=this,b=a.get("view").getSelectedElements(),c=[];return d.each(b,function(b){c.push(a.getItemByElement(b))}),c},clearControl:function(){this.fire("beforeitemsclear"),this.get("view").clearControl(),this.fire("itemsclear")},hasStatus:function(a,b,c){if(!a)return!1;var d=this;return d.getStatusField(b),c=c||d.findElement(a),d.get("view").hasStatus(b,c)},setItemStatus:function(a,b,c,d){var e=this;a&&(d=d||e.findElement(a)),e.isItemDisabled(a,d)&&"disabled"!==b||(a&&("disabled"===b&&c&&e.clearItemStatus(a),e.setStatusValue(a,b,c),e.get("view").setItemStatusCls(b,d,c),e.fire("itemstatuschange",{item:a,status:b,value:c,element:d})),"selected"===b&&e.afterSelected(a,c,d))},clearItemStatus:function(a,b,c){var e=this,f=e.get("itemStatusFields");c=c||e.findElement(a),b?e.setItemStatus(a,b,!1,c):(d.each(f,function(b,d){e.setItemStatus(a,d,!1,c)}),f.selected||e.setItemSelected(a,!1),e.setItemStatus(a,"hover",!1))}}),i.View=h,i}),define("bui/list/keynav",function(){"use strict";var a=function(){};return a.ATTRS={highlightedStatus:{value:"hover"}},BUI.augment(a,{setHighlighted:function(a,b){if(!this.hasStatus(a,"hover",b)){var c=this,d=c.get("highlightedStatus"),e=c._getHighLightedElement(),f=e?c.getItemByElement(e):null;f!==a&&(f&&this.setItemStatus(f,d,!1,e),this.setItemStatus(a,d,!0,b))}},_getHighLightedElement:function(){var a=this,b=a.get("highlightedStatus"),c=a.get("view").getFirstElementByStatus(b);return c},getHighlighted:function(){var a=this,b=a.get("highlightedStatus"),c=a.get("view").getFirstElementByStatus(b);return a.getItemByElement(c)||null},getColumnCount:function(){var a=this,b=a.getFirstItem(),c=a.findElement(b),d=$(c);return c?parseInt(d.parent().width()/d.outerWidth(),10):1},getRowCount:function(a){var b=this;return a=a||b.getColumnCount(),(this.getCount()+a-1)/a},_getNextItem:function(a,b,c){var d,e=this,f=e._getCurrentIndex(),g=e.getCount(),h=a?1:-1;return-1===f?a?e.getFirstItem():e.getLastItem():(a||(b*=h),d=(f+b+c)%c,d>g-1&&(a?d-=g-1:d+=b),e.getItemAt(d))},_getLeftItem:function(){var a=this,b=a.getCount(),c=a.getColumnCount();return!b||1>=c?null:a._getNextItem(!1,1,b)},_getCurrentItem:function(){return this.getHighlighted()},_getCurrentIndex:function(){var a=this,b=a._getCurrentItem();return this.indexOfItem(b)},_getRightItem:function(){var a=this,b=a.getCount(),c=a.getColumnCount();return!b||1>=c?null:this._getNextItem(!0,1,b)},_getDownItem:function(){var a=this,b=a.getColumnCount(),c=a.getRowCount(b);return 1>=c?null:this._getNextItem(!0,b,b*c)},_getUpperItem:function(){var a=this,b=a.getColumnCount(),c=a.getRowCount(b);return 1>=c?null:this._getNextItem(!1,b,b*c)},handleNavUp:function(){var a=this,b=a._getUpperItem();a.setHighlighted(b)},handleNavDown:function(){this.setHighlighted(this._getDownItem())},handleNavLeft:function(){this.setHighlighted(this._getLeftItem())},handleNavRight:function(){this.setHighlighted(this._getRightItem())},handleNavEnter:function(){var a,b=this,c=b._getCurrentItem();c&&(a=b.findElement(c),$(a).trigger("click"))},handleNavEsc:function(){this.setHighlighted(null)},handleNavTab:function(){this.setHighlighted(this._getRightItem())}}),a}),define("bui/list/simplelist",["bui/common","bui/list/domlist","bui/list/keynav","bui/list/sortable"],function(a){var b=a("bui/common"),c=b.Component.UIBase,d=a("bui/list/domlist"),e=a("bui/list/keynav"),f=a("bui/list/sortable"),g=b.prefix+"list-item",h=b.Component.View.extend([d.View],{setElementHover:function(a,b){var c=this;c.setItemStatusCls("hover",a,b)}},{ATTRS:{itemContainer:{valueFn:function(){return this.get("el").find(this.get("listSelector"))}}}},{xclass:"simple-list-view"}),i=b.Component.Controller.extend([d,c.Bindable,e,f],{bindUI:function(){var a=this,b=a.get("itemCls"),c=a.get("view").getItemContainer();c.delegate("."+b,"mouseover",function(b){if(!a.get("disabled")){var c=b.currentTarget,d=a.getItemByElement(c);a.isItemDisabled(b.item,b.currentTarget)||("hover"===a.get("highlightedStatus")?a.setHighlighted(d,c):a.setItemStatus(d,"hover",!0,c))}}).delegate("."+b,"mouseout",function(b){if(!a.get("disabled")){var c=$(b.currentTarget);a.get("view").setElementHover(c,!1)}})},onAdd:function(a){var b=this,c=b.get("store"),d=a.record;0==b.getCount()?b.setItems(c.getResult()):b.addItemToView(d,a.index)},onRemove:function(a){var b=this,c=a.record;b.removeItem(c)},onUpdate:function(a){this.updateItem(a.record)},onLocalSort:function(a){this.sort(a.field,a.direction)},onLoad:function(){var a=this,b=a.get("store"),c=b.getResult();a.set("items",c)}},{ATTRS:{items:{view:!0,value:[]},itemCls:{view:!0,value:g},idField:{value:"value"},listSelector:{view:!0,value:"ul"},itemTpl:{view:!0,value:'<li role="option" class="'+g+'">{text}</li>'},tpl:{value:"<ul></ul>"},xview:{value:h}}},{xclass:"simple-list",prority:0});return i.View=h,i}),define("bui/list/listbox",["bui/list/simplelist"],function(a){var b=a("bui/list/simplelist"),c=b.extend({bindUI:function(){var a=this;a.on("selectedchange",function(a){var b=a.item,c=$(a.domTarget),d=c.find("input");b&&d.attr("checked",a.selected)})}},{ATTRS:{itemTpl:{value:'<li><span class="x-checkbox"></span>{text}</li>'},multipleSelect:{value:!0}}},{xclass:"listbox"});return c}),define("bui/list/listitem",function(){var a=BUI.Component,b=a.UIBase,c=a.View.extend([b.ListItemView],{}),d=a.Controller.extend([b.ListItem],{},{ATTRS:{elTagName:{view:!0,value:"li"},xview:{value:c},tpl:{view:!0,value:"<span>{text}</span>"}}},{xclass:"list-item"});return d.View=c,d}),define("bui/list/list",function(){var a=BUI.Component,b=a.UIBase,c=a.Controller.extend([b.ChildList],{},{ATTRS:{elTagName:{view:!0,value:"ul"},idField:{value:"id"},defaultChildClass:{value:"list-item"}}},{xclass:"list"});return c});