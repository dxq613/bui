/*! BUI - v0.1.0 - 2013-11-18
* https://github.com/dxq613/bui
* Copyright (c) 2013 dxq613; Licensed MIT */
define("bui/tab",["bui/common","bui/tab/tab","bui/tab/tabitem","bui/tab/navtabitem","bui/tab/navtab","bui/tab/tabpanel","bui/tab/tabpanelitem"],function(a){var b=a("bui/common"),c=b.namespace("Tab");return b.mix(c,{Tab:a("bui/tab/tab"),TabItem:a("bui/tab/tabitem"),NavTabItem:a("bui/tab/navtabitem"),NavTab:a("bui/tab/navtab"),TabPanel:a("bui/tab/tabpanel"),TabPanelItem:a("bui/tab/tabpanelitem")}),c}),define("bui/tab/navtabitem",["bui/common"],function(a){var b=a("bui/common"),c=b.Component,d="tab-item-title",e="tab-item-close",f="tab-item-inner",g="tab-nav-actived",h="tab-content",i=c.View.extend({renderUI:function(){var a=this,b=a.get("tabContentContainer"),c=a.get("tabContentTpl");if(b){var d=$(c).appendTo(b);a.set("tabContentEl",d)}},_uiSetHref:function(a){this._setHref(a)},_setHref:function(a){var b=this,c=b.get("tabContentEl");a=a||b.get("href"),c&&$("iframe",c).attr("src",a)},resetHref:function(){this._setHref()},_uiSetTitle:function(a){var b=this,c=b.get("el");c.attr("title",a),$("."+d,c).text(a)},_uiSetActived:function(a){var b=this,c=b.get("el");b.setTabContentVisible(a),a?c.addClass(g):c.removeClass(g)},destructor:function(){var a=this,b=a.get("tabContentEl");b&&b.remove()},setTabContentVisible:function(a){var b=this,c=b.get("tabContentEl");c&&(a?c.show():c.hide())}},{ATTRS:{tabContentContainer:{},tabContentEl:{},title:{},href:{}}}),j=c.Controller.extend({createDom:function(){var a=this,b=a.get("parent");b&&a.set("tabContentContainer",b.getTabContentContainer())},bindUI:function(){var a=this,b=a.get("el");a.get("events"),b.on("click",function(b){var c=$(b.target);c.hasClass(e)&&a.fire("closing")!==!1&&a.close()})},handleDblClick:function(a){var b=this;b.get("closeable")&&b.fire("closing")!==!1&&b.close(),b.fire("dblclick",{domTarget:a.target,domEvent:a})},handleContextMenu:function(a){a.preventDefault(),this.fire("showmenu",{position:{x:a.pageX,y:a.pageY}})},setTitle:function(a){this.set("title",a)},close:function(){this.fire("closed")},reload:function(){this.get("view").resetHref()},show:function(){var a=this;a.get("el").show(500,function(){a.set("visible",!0)})},hide:function(a){var b=this;this.get("el").hide(500,function(){b.set("visible",!1),a&&a()})},_uiSetActived:function(a){var b=this,c=b.get("parent");c&&a&&c._setItemActived(b)},_uiSetCloseable:function(a){var b=this,c=b.get("el"),d=c.find("."+e);a?d.show():d.hide()}},{ATTRS:{elTagName:{value:"li"},actived:{view:!0,value:!1},closeable:{value:!0},allowTextSelection:{view:!1,value:!1},events:{value:{click:!0,closing:!0,closed:!0,showmenu:!0,afterVisibleChange:!0}},tabContentContainer:{view:!0},tabContentTpl:{view:!0,value:'<div class="'+h+'" style="display:none;"><iframe src="" width="100%" height="100%" frameborder="0"></iframe></div>'},href:{view:!0,value:""},visible:{view:!0,value:!0},title:{view:!0,value:""},tpl:{view:!0,value:'<s class="l"></s><div class="'+f+'">{icon}<span class="'+d+'"></span><s class="'+e+'"></s></div><s class="r"></s>'},xview:{value:i}}},{xclass:"nav-tab-item",priority:0});return j.View=i,j}),define("bui/tab/navtab",["bui/common","bui/menu"],function(a){var b=a("bui/common"),c=a("bui/menu"),d=b.Component,e="tab-nav-list",f="arrow-left",g="arrow-right",h=b.prefix+"tab-force",i="m_close",j=140,k=d.View.extend({renderUI:function(){var a=this,b=a.get("el"),c=null;c=b.find("."+e),a.setInternal("listEl",c)},getContentElement:function(){return this.get("listEl")},getTabContentContainer:function(){return this.get("el").find(".tab-content-container")},_uiSetHeight:function(a){var b=this,c=b.get("el"),d=c.find(".tab-nav-bar"),e=b.getTabContentContainer();a&&e.height(a-d.height()),c.height(a)},_uiSetForceFit:function(a){var b=this,c=b.get("el");a?c.addClass(h):c.removeClass(h)}},{ATTRS:{forceFit:{}}},{xclass:"nav-tab-view",priority:0}),l=d.Controller.extend({addTab:function(a,c){var d=this,e=a.id||b.guid("tab-item"),f=d.get("forceFit"),g=d.getItemById(e);if(g){var h=!1;a.href&&g.get("href")!=a.href&&(g.set("href",a.href),h=!0),d._setItemActived(g),c&&!h&&g.reload()}else a=b.mix({id:e,visible:!1,actived:!0,xclass:"nav-tab-item"},a),g=d.addChild(a),f&&d.forceFit(),g.show(),d._resetItemList();return g},getTabContentContainer:function(){return this.get("view").getTabContentContainer()},bindUI:function(){var a=this,b=a.get("forceFit");b||(a._bindScrollEvent(),a.on("afterVisibleChange",function(b){var c=b.target;c.get("actived")&&a._scrollToItem(c)})),a.on("click",function(b){var c=b.target;c!=a&&(a._setItemActived(c),a.fire("itemclick",{item:c}))}),a.on("closed",function(b){var c=b.target;a._closeItem(c)}),a.on("showmenu",function(b){a._showMenu(b.target,b.position)})},_bindScrollEvent:function(){var a=this,b=a.get("el");b.find(".arrow-left").on("click",function(){b.hasClass(f+"-active")&&a._scrollLeft()}),b.find(".arrow-right").on("click",function(){b.hasClass(g+"-active")&&a._scrllRight()})},_showMenu:function(a,b){var c,d=this,e=d._getMenu(),f=a.get("closeable");d.set("showMenuItem",a),e.set("xy",[b.x,b.y]),e.show(),c=e.getItem(i),c&&c.set("disabled",!f)},setActived:function(a){var b=this,c=b.getItemById(a);b._setItemActived(c)},getActivedItem:function(){var a=this,c=a.get("children"),d=null;return b.each(c,function(a){return a.get("actived")?(d=a,!1):void 0}),d},getItemById:function(a){var c=this,d=c.get("children"),e=null;return b.each(d,function(b){return b.get("id")===a?(e=b,!1):void 0}),e},_getMenu:function(){var a=this;return a.get("menu")||a._initMenu()},_initMenu:function(){var a=this,b=new c.ContextMenu({children:[{xclass:"context-menu-item",iconCls:"icon icon-refresh",text:"\u5237\u65b0",listeners:{click:function(){var b=a.get("showMenuItem");b&&b.reload()}}},{id:i,xclass:"context-menu-item",iconCls:"icon icon-remove",text:"\u5173\u95ed",listeners:{click:function(){var b=a.get("showMenuItem");b&&b.close()}}},{xclass:"context-menu-item",iconCls:"icon icon-remove-sign",text:"\u5173\u95ed\u5176\u4ed6",listeners:{click:function(){var b=a.get("showMenuItem");b&&a.closeOther(b)}}},{xclass:"context-menu-item",iconCls:"icon icon-remove-sign",text:"\u5173\u95ed\u6240\u6709",listeners:{click:function(){a.closeAll()}}}]});return a.set("menu",b),b},_closeItem:function(a){var b=this,c=b._getIndex(a),d=b.getActivedItem(),e=b.get("preItem")||b._getItemByIndex(c-1),f=b._getItemByIndex(c+1);a.hide(function(){b.removeChild(a,!0),b._resetItemList(),d===a?e?b._setItemActived(e):b._setItemActived(f):b._scrollToItem(d),b.forceFit()})},closeAll:function(){var a=this,c=a.get("children");b.each(c,function(a){a.close()})},closeOther:function(a){var c=this,d=c.get("children");b.each(d,function(b){a!==b&&b.close()})},_getItemByIndex:function(a){var b=this,c=b.get("children");return c[a]},_getIndex:function(a){var c=this,d=c.get("children");return b.Array.indexOf(a,d)},_resetItemList:function(){if(!this.get("forceFit")){var a=this,b=a.getContentElement();b.width(a._getTotalWidth())}},_getTotalWidth:function(){var a=this,b=a.get("children");return b.length*a.get("itemWidth")},_getForceItemWidth:function(){var a=this,b=a.getContentElement().width(),c=a.get("children"),d=a._getTotalWidth(),e=a.get(e);return d>b&&(e=b/c.length),e},forceFit:function(){var a=this;a._forceItemWidth(a._getForceItemWidth())},_forceItemWidth:function(a){a=a||this.get("itemWidth");var c=this,d=c.get("children");b.each(d,function(b){b.set("width",a)})},_scrollToItem:function(a){if(!this.get("forceFit")){var b=this,c=b.getContentElement(),d=c.position(),e=b._getDistanceToEnd(a,c,d),f=b._getDistanceToBegin(a,d);if(c.width()<c.parent().width())b._scrollTo(c,0);else if(0>f)b._scrollTo(c,d.left-f);else if(e>0)b._scrollTo(c,d.left+-1*e);else if(d.left<0){var g=b._getLastDistance(c,d),h=0;0>g&&(h=d.left-g,h=0>h?h:0,b._scrollTo(c,h))}}},_getDistanceToBegin:function(a,b){var c=a.get("el").position();return c.left+b.left},_getDistanceToEnd:function(a,b,c){var d=this,b=b||d.getContentElement(),e=b.parent().width(),c=c||b.position(),f=d._getDistanceToBegin(a,c),g=f+d.get("itemWidth")-e;return g},_getLastDistance:function(a,b){var c=this,d=c.get("children"),e=d[d.length-1];return e?c._getDistanceToEnd(e,a,b):0},_scrollTo:function(a,b){var c=this;a.animate({left:b},500,function(){c._setArrowStatus(a)})},_scrollLeft:function(){var a,b=this,c=b.getContentElement(),d=c.position(),e=b._getLastDistance(c,d);e>0&&(a=e>b.get("itemWidth")?b.get("itemWidth"):e,b._scrollTo(c,d.left-a))},_scrllRight:function(){var a,b=this,c=b.getContentElement(),d=c.position();d.left<0&&(a=d.left+b.get("itemWidth"),a=0>a?a:0,b._scrollTo(c,a))},_setArrowStatus:function(a,b){a=a||this.getContentElement();var c=this,d=c.get("el"),e=b||a.position(),h=c._getLastDistance(a,b);e.left<0?d.addClass(g+"-active"):d.removeClass(g+"-active"),h>0?d.addClass(f+"-active"):d.removeClass(f+"-active")},_setItemActived:function(a){var b=this,c=b.getActivedItem();a!==c&&(c&&c.set("actived",!1),b.set("preItem",c),a&&(a.get("actived")||a.set("actived",!0),a.get("visible")&&b._scrollToItem(a),b.fire("activeChange",{item:a})))}},{ATTRS:{defaultChildClass:{value:"nav-tab-item"},menu:{},forceFit:{view:!0,value:!1},itemWidth:{value:j},tpl:{view:!0,value:'<div class="tab-nav-bar"><s class="tab-nav-arrow arrow-left"></s><div class="tab-nav-wrapper"><div class="tab-nav-inner"><ul class="'+e+'"></ul></div></div><s class="tab-nav-arrow arrow-right"></s>'+"</div>"+'<div class="tab-content-container"></div>'},xview:{value:k},events:{value:{itemclick:!1}}}},{xclass:"nav-tab",priority:0});return l}),define("bui/tab/tabitem",["bui/common"],function(a){var b=a("bui/common"),c=b.Component,d=c.UIBase,e=c.View.extend([d.ListItemView],{},{xclass:"tab-item-view"}),f=c.Controller.extend([d.ListItem],{},{ATTRS:{elTagName:{view:!0,value:"li"},xview:{value:e},tpl:{view:!0,value:'<span class="bui-tab-item-text">{text}</span>'}}},{xclass:"tab-item"});return f.View=e,f}),define("bui/tab/tab",["bui/common"],function(a){var b=a("bui/common"),c=b.Component,d=c.UIBase,e=c.Controller.extend([d.ChildList],{},{ATTRS:{elTagName:{view:!0,value:"ul"},defaultChildClass:{value:"tab-item"}}},{xclass:"tab"});return e}),define("bui/tab/tabpanelitem",["bui/common","bui/tab/tabitem","bui/tab/panelitem"],function(a){var b=a("bui/common"),c=a("bui/tab/tabitem"),d=a("bui/tab/panelitem"),e=b.Component,f=c.View.extend([e.UIBase.Close.View],{},{xclass:"tab-panel-item-view"}),g=c.extend([d,e.UIBase.Close],{},{ATTRS:{closeAction:{value:"remove"},events:{value:{beforeclosed:!0}},xview:{value:f}}},{xclass:"tab-panel-item"});return g.View=f,g}),define("bui/tab/tabpanel",["bui/common","bui/tab/tab","bui/tab/panels"],function(a){var b=(a("bui/common"),a("bui/tab/tab")),c=a("bui/tab/panels"),d=b.extend([c],{bindUI:function(){var a=this;a.on("beforeclosed",function(b){var c=b.target;a._beforeClosedItem(c)})},_beforeClosedItem:function(a){if(a.get("selected")){var b,c,d=this,e=d.indexOfItem(a),f=d.getItemCount();e!==f-1?(c=d.getItemAt(e+1),d.setSelected(c)):0!==e&&(b=d.getItemAt(e-1),d.setSelected(b))}}},{ATTRS:{elTagName:{value:"div"},childContainer:{value:"ul"},tpl:{value:'<div class="tab-panel-inner"><ul></ul><div class="tab-panels"></div></div>'},panelTpl:{value:"<div></div>"},panelContainer:{value:".tab-panels"},defaultChildClass:{value:"tab-panel-item"}}},{xclass:"tab-panel"});return d});