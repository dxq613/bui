/*! BUI - v0.1.0 - 2013-11-18
* https://github.com/dxq613/bui
* Copyright (c) 2013 dxq613; Licensed MIT */
define("bui/editor",["bui/common","bui/form","bui/editor/editor","bui/editor/record","bui/editor/dialog"],function(a){var b=a("bui/common"),c=(a("bui/form"),b.namespace("Editor"));return b.mix(c,{Editor:a("bui/editor/editor"),RecordEditor:a("bui/editor/record"),DialogEditor:a("bui/editor/dialog")}),c}),define("bui/editor/mixin",function(){function a(a){var b=a,c=b.get("controlCfgField"),d=b.get(c),e=b.addChild(d);b.setInternal(c,e)}var b=function(){a(this)};return b.ATTRS={acceptEvent:{value:"autohide"},preventHide:{value:!0},changeSourceEvent:{value:"show triggerchange"},ignoreInputFields:{value:!0},innerValueField:{},emptyValue:{},controlCfgField:{},focusable:{value:!0},autoUpdate:{value:!0},events:{value:{accept:!1,cancel:!1}}},b.prototype={__bindUI:function(){var a=this,b=a.get("acceptEvent"),c=a.get("changeSourceEvent");b&&a.on(b,function(){return a.accept()?void 0:a.get("preventHide")?!1:(a.cancel(),void 0)}),c&&a.on(c,function(){a.setValue(a.getSourceValue()),a.get("visible")&&a.focus()})},getInnerControl:function(){var a=this,b=a.get("children");return b[0]},setValue:function(a,b){var c=this,d=c.getInnerControl();c.set("editValue",a),c.clearControlValue(),d.set(c.get("innerValueField"),a),a||c.valid(),b&&c.clearErrors()},getValue:function(){var a=this,b=a.getInnerControl();return b.get(a.get("innerValueField"))},isValid:function(){var a=this,b=a.getInnerControl();return b.isValid?b.isValid():!0},valid:function(){var a=this,b=a.getInnerControl();b.valid&&b.valid()},getErrors:function(){var a=this,b=a.getInnerControl();return b.getErrors?b.getErrors():[]},isChange:function(){var a=this,b=a.get("editValue"),c=a.getValue();return b!==c},clearValue:function(){this.clearControlValue(),this.clearErrors()},clearControlValue:function(){var a=this,b=a.getInnerControl();b.set(a.get("innerValueField"),a.get("emptyValue"))},clearErrors:function(){var a=this,b=a.getInnerControl();b.clearErrors()},getSourceValue:function(){},updateSource:function(){},handleNavEsc:function(){this.cancel()},handleNavEnter:function(a){var b=a.target;"TEXTAREA"!==b.tagName&&("BUTTON"===b.tagName&&$(b).trigger("click"),this.accept())},focus:function(){var a=this,b=a.getInnerControl();b.focus&&b.focus()},accept:function(){var a,b=this;return b.valid(),b.isValid()?(a=b.getValue(),b.get("autoUpdate")&&b.updateSource(a),0!=b.fire("beforeaccept",{value:a})?(b.fire("accept",{value:a,editValue:b.get("editValue")}),b.hide(),!0):void 0):!1},cancel:function(){this.fire("cancel"),this.clearValue(),this.close()}},b}),define("bui/editor/editor",["bui/common","bui/overlay","bui/editor/mixin"],function(a){var b=a("bui/common"),c=a("bui/overlay").Overlay;CLS_TIPS="x-editor-tips",Mixin=a("bui/editor/mixin");var d=c.extend([Mixin],{bindUI:function(){var a=this;a.getInnerControl(),a.on("validchange",function(){!a.isValid()&&a.get("visible")?a._showError(a.getErrors()):a._hideError()}),a.on("hide",function(){a._hideError()}),a.on("show",function(){a.isValid()||a._showError(a.getErrors())})},_initOverlay:function(){var a=this,b=new c({children:[{xclass:"simple-list",itemTpl:'<li><span class="x-icon x-icon-mini x-icon-error" title="{error}">!</span>&nbsp;<span>{error}</span></li>'}],elCls:CLS_TIPS,autoRender:!0});return a.set("overlay",b),b},_getErrorList:function(){var a=this,b=a.get("overlay");return b&&b.get("children")[0]},_showError:function(a){var c=this,d=c.get("overlay")||c._initOverlay(),e=c._getErrorList(),f=c.get("errorAlign"),g=b.Array.map(a,function(a){return{error:a}});e.set("items",g),f.node=c.get("el"),d.set("align",f),d.show()},_hideError:function(){var a=this,b=a.get("overlay");b&&b.hide()},getSourceValue:function(){var a=this,b=a.get("curTrigger");return b.text()},updateSource:function(a){var b=this,c=b.get("curTrigger");c&&c.length&&c.text(a)},_uiSetWidth:function(a){var b=this;if(null!=a){var c=b.getInnerControl();c.set&&c.set("width",a)}}},{ATTRS:{innerValueField:{value:"value"},emptyValue:{value:""},autoHide:{value:!0},controlCfgField:{value:"field"},defaultChildCfg:{value:{tpl:"",forceFit:!0,errorTpl:""}},defaultChildClass:{value:"form-field"},align:{value:{points:["tl","tl"]}},errorAlign:{value:{points:["bl","tl"],offset:[0,10]}},overlay:{},field:{value:{}}}},{xclass:"editor"});return d}),define("bui/editor/record",["bui/common","bui/editor/editor"],function(a){var b=a("bui/common"),c=a("bui/editor/editor"),d=c.extend({getSourceValue:function(){return this.get("record")},updateSource:function(a){var c=this,d=c.get("record");b.mix(d,a)},_uiSetRecord:function(a){this.setValue(a)}},{ATTRS:{innerValueField:{value:"record"},acceptEvent:{value:""},emptyValue:{value:{}},autoHide:{value:!1},record:{value:{}},controlCfgField:{value:"form"},form:{value:{}},errorAlign:{value:{points:["tr","tl"],offset:[10,0]}},defaultChildCfg:{valueFn:function(){var a=this;return{xclass:"form",errorTpl:"",showError:!0,showChildError:!0,defaultChildCfg:{elCls:"bui-inline-block",tpl:"",forceFit:!0},buttons:[{btnCls:"button button-primary",text:"\u786e\u5b9a",handler:function(){a.accept()}},{btnCls:"button",text:"\u53d6\u6d88",handler:function(){a.cancel()}}]}}}}},{xclass:"record-editor"});return d}),define("bui/editor/dialog",["bui/overlay","bui/editor/mixin"],function(a){var b=a("bui/overlay").Dialog,c=a("bui/editor/mixin"),d=b.extend([c],{getSourceValue:function(){return this.get("record")},handleNavEnter:function(a){var b=this,c=b.get("success"),d=a.target;"TEXTAREA"!==d.tagName&&("BUTTON"===d.tagName&&$(d).trigger("click"),c?c.call(b):this.accept())},cancel:function(){this.fire("cancel"),this.clearValue(),this.close()},updateSource:function(a){var b=this,c=b.get("record");BUI.mix(c,a)},_uiSetRecord:function(a){this.setValue(a)}},{ATTRS:{innerValueField:{value:"record"},acceptEvent:{value:""},record:{value:{}},emptyValue:{value:{}},controlCfgField:{value:"form"},changeSourceEvent:{value:""},defaultChildCfg:{value:{xclass:"form-horizontal"}},focusable:{value:!1},success:{value:function(){this.accept()}},cancel:{value:function(){this.cancel()}},form:{value:{}}}},{xclass:"dialog-editor"});return d});